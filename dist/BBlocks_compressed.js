window.PolymerGestures={},function(a){var b=!1,c=document.createElement("meta");if(c.createShadowRoot){var d=c.createShadowRoot(),e=document.createElement("span");d.appendChild(e),c.addEventListener("testpath",function(a){a.path&&(b=a.path[0]===e),a.stopPropagation()});var f=new CustomEvent("testpath",{bubbles:!0});document.head.appendChild(c),e.dispatchEvent(f),c.parentNode.removeChild(c),d=e=null}c=null;var g={shadow:function(a){return a?a.shadowRoot||a.webkitShadowRoot:void 0},canTarget:function(a){return a&&Boolean(a.elementFromPoint)},targetingShadow:function(a){var b=this.shadow(a);return this.canTarget(b)?b:void 0},olderShadow:function(a){var b=a.olderShadowRoot;if(!b){var c=a.querySelector("shadow");c&&(b=c.olderShadowRoot)}return b},allShadows:function(a){for(var b=[],c=this.shadow(a);c;)b.push(c),c=this.olderShadow(c);return b},searchRoot:function(a,b,c){var d,e;return a?(d=a.elementFromPoint(b,c),d?e=this.targetingShadow(d):a!==document&&(e=this.olderShadow(a)),this.searchRoot(e,b,c)||d):void 0},owner:function(a){if(!a)return document;for(var b=a;b.parentNode;)b=b.parentNode;return b.nodeType!=Node.DOCUMENT_NODE&&b.nodeType!=Node.DOCUMENT_FRAGMENT_NODE&&(b=document),b},findTarget:function(a){if(b&&a.path&&a.path.length)return a.path[0];var c=a.clientX,d=a.clientY,e=this.owner(a.target);return e.elementFromPoint(c,d)||(e=document),this.searchRoot(e,c,d)},findTouchAction:function(a){var c;if(b&&a.path&&a.path.length){for(var d=a.path,e=0;e<d.length;e++)if(c=d[e],c.nodeType===Node.ELEMENT_NODE&&c.hasAttribute("touch-action"))return c.getAttribute("touch-action")}else for(c=a.target;c;){if(c.nodeType===Node.ELEMENT_NODE&&c.hasAttribute("touch-action"))return c.getAttribute("touch-action");c=c.parentNode||c.host}return"auto"},LCA:function(a,b){if(a===b)return a;if(a&&!b)return a;if(b&&!a)return b;if(!b&&!a)return document;if(a.contains&&a.contains(b))return a;if(b.contains&&b.contains(a))return b;var c=this.depth(a),d=this.depth(b),e=c-d;for(e>=0?a=this.walk(a,e):b=this.walk(b,-e);a&&b&&a!==b;)a=a.parentNode||a.host,b=b.parentNode||b.host;return a},walk:function(a,b){for(var c=0;a&&b>c;c++)a=a.parentNode||a.host;return a},depth:function(a){for(var b=0;a;)b++,a=a.parentNode||a.host;return b},deepContains:function(a,b){var c=this.LCA(a,b);return c===a},insideNode:function(a,b,c){var d=a.getBoundingClientRect();return d.left<=b&&b<=d.right&&d.top<=c&&c<=d.bottom},path:function(a){var c;if(b&&a.path&&a.path.length)c=a.path;else{c=[];for(var d=this.findTarget(a);d;)c.push(d),d=d.parentNode||d.host}return c}};a.targetFinding=g,a.findTarget=g.findTarget.bind(g),a.deepContains=g.deepContains.bind(g),a.insideNode=g.insideNode}(window.PolymerGestures),function(){function a(a){return"html /deep/ "+b(a)}function b(a){return'[touch-action="'+a+'"]'}function c(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+";}"}var d=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]},"manipulation"],e="",f="string"==typeof document.head.style.touchAction,g=!window.ShadowDOMPolyfill&&document.head.createShadowRoot;if(f){d.forEach(function(d){String(d)===d?(e+=b(d)+c(d)+"\n",g&&(e+=a(d)+c(d)+"\n")):(e+=d.selectors.map(b)+c(d.rule)+"\n",g&&(e+=d.selectors.map(a)+c(d.rule)+"\n"))});var h=document.createElement("style");h.textContent=e,document.head.appendChild(h)}}(),function(a){var b=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],c=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],d=function(){return function(){}},e={preventTap:d,makeBaseEvent:function(a,b){var c=document.createEvent("Event");return c.initEvent(a,b.bubbles||!1,b.cancelable||!1),c.preventTap=e.preventTap(c),c},makeGestureEvent:function(a,b){b=b||Object.create(null);for(var c,d=this.makeBaseEvent(a,b),e=0,f=Object.keys(b);e<f.length;e++)c=f[e],"bubbles"!==c&&"cancelable"!==c&&(d[c]=b[c]);return d},makePointerEvent:function(a,d){d=d||Object.create(null);for(var e,f=this.makeBaseEvent(a,d),g=2;g<b.length;g++)e=b[g],f[e]=d[e]||c[g];f.buttons=d.buttons||0;var h=0;return h=d.pressure?d.pressure:f.buttons?.5:0,f.x=f.clientX,f.y=f.clientY,f.pointerId=d.pointerId||0,f.width=d.width||0,f.height=d.height||0,f.pressure=h,f.tiltX=d.tiltX||0,f.tiltY=d.tiltY||0,f.pointerType=d.pointerType||"",f.hwTimestamp=d.hwTimestamp||0,f.isPrimary=d.isPrimary||!1,f._source=d._source||"",f}};a.eventFactory=e}(window.PolymerGestures),function(a){function b(){if(c){var a=new Map;return a.pointers=d,a}this.keys=[],this.values=[]}var c=window.Map&&window.Map.prototype.forEach,d=function(){return this.size};b.prototype={set:function(a,b){var c=this.keys.indexOf(a);c>-1?this.values[c]=b:(this.keys.push(a),this.values.push(b))},has:function(a){return this.keys.indexOf(a)>-1},"delete":function(a){var b=this.keys.indexOf(a);b>-1&&(this.keys.splice(b,1),this.values.splice(b,1))},get:function(a){var b=this.keys.indexOf(a);return this.values[b]},clear:function(){this.keys.length=0,this.values.length=0},forEach:function(a,b){this.values.forEach(function(c,d){a.call(b,c,this.keys[d],this)},this)},pointers:function(){return this.keys.length}},a.PointerMap=b}(window.PolymerGestures),function(a){var b,c=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp","preventTap","tapPrevented","_source"],d=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0,function(){},!1],e="undefined"!=typeof SVGElementInstance,f=a.eventFactory,g={IS_IOS:!1,pointermap:new a.PointerMap,requiredGestures:new a.PointerMap,eventMap:Object.create(null),eventSources:Object.create(null),eventSourceList:[],gestures:[],dependencyMap:{down:{listeners:0,index:-1},up:{listeners:0,index:-1}},gestureQueue:[],registerSource:function(a,b){var c=b,d=c.events;d&&(d.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},registerGesture:function(a,b){var c=Object.create(null);c.listeners=0,c.index=this.gestures.length;for(var d,e=0;e<b.exposes.length;e++)d=b.exposes[e].toLowerCase(),this.dependencyMap[d]=c;this.gestures.push(b)},register:function(a,b){for(var c,d=this.eventSourceList.length,e=0;d>e&&(c=this.eventSourceList[e]);e++)c.register.call(c,a,b)},unregister:function(a){for(var b,c=this.eventSourceList.length,d=0;c>d&&(b=this.eventSourceList[d]);d++)b.unregister.call(b,a)},down:function(a){this.requiredGestures.set(a.pointerId,b),this.fireEvent("down",a)},move:function(a){a.type="move",this.fillGestureQueue(a)},up:function(a){this.fireEvent("up",a),this.requiredGestures["delete"](a.pointerId)},cancel:function(a){a.tapPrevented=!0,this.fireEvent("up",a),this.requiredGestures["delete"](a.pointerId)},addGestureDependency:function(a,b){var c=a._pgEvents;if(c&&b)for(var d,e,f,g=Object.keys(c),h=0;h<g.length;h++)f=g[h],c[f]>0&&(d=this.dependencyMap[f],e=d?d.index:-1,b[e]=!0)},eventHandler:function(c){var d=c.type;if("touchstart"===d||"mousedown"===d||"pointerdown"===d||"MSPointerDown"===d)if(c._handledByPG||(b={}),this.IS_IOS){var e=c;if("touchstart"===d){var f=c.changedTouches[0];e={target:c.target,clientX:f.clientX,clientY:f.clientY,path:c.path}}for(var g,h=c.path||a.targetFinding.path(e),i=0;i<h.length;i++)g=h[i],this.addGestureDependency(g,b)}else this.addGestureDependency(c.currentTarget,b);if(!c._handledByPG){var j=this.eventMap&&this.eventMap[d];j&&j(c),c._handledByPG=!0}},listen:function(a,b){for(var c,d=0,e=b.length;e>d&&(c=b[d]);d++)this.addEvent(a,c)},unlisten:function(a,b){for(var c,d=0,e=b.length;e>d&&(c=b[d]);d++)this.removeEvent(a,c)},addEvent:function(a,b){a.addEventListener(b,this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){var c=f.makePointerEvent(a,b);return c.preventDefault=b.preventDefault,c.tapPrevented=b.tapPrevented,c._target=c._target||b.target,c},fireEvent:function(a,b){var c=this.makeEvent(a,b);return this.dispatchEvent(c)},cloneEvent:function(a){for(var b,f=Object.create(null),g=0;g<c.length;g++)b=c[g],f[b]=a[b]||d[g],("target"===b||"relatedTarget"===b)&&e&&f[b]instanceof SVGElementInstance&&(f[b]=f[b].correspondingUseElement);return f.preventDefault=function(){a.preventDefault()},f},dispatchEvent:function(a){var b=a._target;if(b){b.dispatchEvent(a);var c=this.cloneEvent(a);c.target=b,this.fillGestureQueue(c)}},gestureTrigger:function(){for(var a,b,c=0;c<this.gestureQueue.length;c++)if(a=this.gestureQueue[c],b=a._requiredGestures)for(var d,e,f=0;f<this.gestures.length;f++)b[f]&&(d=this.gestures[f],e=d[a.type],e&&e.call(d,a));this.gestureQueue.length=0},fillGestureQueue:function(a){this.gestureQueue.length||requestAnimationFrame(this.boundGestureTrigger),a._requiredGestures=this.requiredGestures.get(a.pointerId),this.gestureQueue.push(a)}};g.boundHandler=g.eventHandler.bind(g),g.boundGestureTrigger=g.gestureTrigger.bind(g),a.dispatcher=g,a.activateGesture=function(a,b){var c=b.toLowerCase(),d=g.dependencyMap[c];if(d){var e=g.gestures[d.index];if(a._pgListeners||(g.register(a),a._pgListeners=0),e){var f,h=e.defaultActions&&e.defaultActions[c];switch(a.nodeType){case Node.ELEMENT_NODE:f=a;break;case Node.DOCUMENT_FRAGMENT_NODE:f=a.host;break;default:f=null}h&&f&&!f.hasAttribute("touch-action")&&f.setAttribute("touch-action",h)}a._pgEvents||(a._pgEvents={}),a._pgEvents[c]=(a._pgEvents[c]||0)+1,a._pgListeners++}return Boolean(d)},a.addEventListener=function(b,c,d,e){d&&(a.activateGesture(b,c),b.addEventListener(c,d,e))},a.deactivateGesture=function(a,b){var c=b.toLowerCase(),d=g.dependencyMap[c];return d&&(a._pgListeners>0&&a._pgListeners--,0===a._pgListeners&&g.unregister(a),a._pgEvents&&(a._pgEvents[c]>0?a._pgEvents[c]--:a._pgEvents[c]=0)),Boolean(d)},a.removeEventListener=function(b,c,d,e){d&&(a.deactivateGesture(b,c),b.removeEventListener(c,d,e))}}(window.PolymerGestures),function(a){var b=a.dispatcher,c=b.pointermap,d=25,e=[0,1,4,2],f=0,g=/Linux.*Firefox\//i,h=function(){if(g.test(navigator.userAgent))return!1;try{return 1===new MouseEvent("test",{buttons:1}).buttons}catch(a){return!1}}(),i={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup"],exposes:["down","up","move"],register:function(a){b.listen(a,this.events)},unregister:function(a){a.nodeType!==Node.DOCUMENT_NODE&&b.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){for(var b,c=this.lastTouches,e=a.clientX,f=a.clientY,g=0,h=c.length;h>g&&(b=c[g]);g++){var i=Math.abs(e-b.x),j=Math.abs(f-b.y);if(d>=i&&d>=j)return!0}},prepareEvent:function(a){var c=b.cloneEvent(a);if(c.pointerId=this.POINTER_ID,c.isPrimary=!0,c.pointerType=this.POINTER_TYPE,c._source="mouse",!h){var d=a.type,g=e[a.which]||0;"mousedown"===d?f|=g:"mouseup"===d&&(f&=~g),c.buttons=f}return c},mousedown:function(d){if(!this.isEventSimulatedFromTouch(d)){var e=(c.has(this.POINTER_ID),this.prepareEvent(d));e.target=a.findTarget(d),c.set(this.POINTER_ID,e.target),b.down(e)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var d=c.get(this.POINTER_ID);if(d){var e=this.prepareEvent(a);e.target=d,0===(h?e.buttons:e.which)?(h||(f=e.buttons=0),b.cancel(e),this.cleanupMouse(e.buttons)):b.move(e)}}},mouseup:function(d){if(!this.isEventSimulatedFromTouch(d)){var e=this.prepareEvent(d);e.relatedTarget=a.findTarget(d),e.target=c.get(this.POINTER_ID),b.up(e),this.cleanupMouse(e.buttons)}},cleanupMouse:function(a){0===a&&c["delete"](this.POINTER_ID)}};a.mouseEvents=i}(window.PolymerGestures),function(a){var b=a.dispatcher,c=(a.targetFinding.allShadows.bind(a.targetFinding),b.pointermap),d=(Array.prototype.map.call.bind(Array.prototype.map),2500),e=25,f=200,g=20,h=!1,i={IS_IOS:!1,events:["touchstart","touchmove","touchend","touchcancel"],exposes:["down","up","move"],register:function(a,c){(this.IS_IOS?c:!c)&&b.listen(a,this.events)},unregister:function(a){this.IS_IOS||b.unlisten(a,this.events)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y"},touchActionToScrollType:function(a){var b=a,c=this.scrollTypes;return b===c.EMITTER?"none":b===c.XSCROLLER?"X":b===c.YSCROLLER?"Y":"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){(0===c.pointers()||1===c.pointers()&&c.has(1))&&(this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.firstTarget=a.target,this.scrolling=null,this.cancelResetClickCount())},removePrimaryPointer:function(a){a.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(a,f)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;return("touchstart"===a||"touchmove"===a)&&(b=1),b},findTarget:function(b,d){if("touchstart"===this.currentTouchEvent.type){if(this.isPrimaryTouch(b)){var e={clientX:b.clientX,clientY:b.clientY,path:this.currentTouchEvent.path,target:this.currentTouchEvent.target};return a.findTarget(e)}return a.findTarget(b)}return c.get(d)},touchToPointer:function(a){var c=this.currentTouchEvent,d=b.cloneEvent(a),e=d.pointerId=a.identifier+2;d.target=this.findTarget(a,e),d.bubbles=!0,d.cancelable=!0,d.detail=this.clickCount,d.buttons=this.typeToButtons(c.type),d.width=a.webkitRadiusX||a.radiusX||0,d.height=a.webkitRadiusY||a.radiusY||0,d.pressure=a.webkitForce||a.force||.5,d.isPrimary=this.isPrimaryTouch(a),d.pointerType=this.POINTER_TYPE,d._source="touch";var f=this;return d.preventDefault=function(){f.scrolling=!1,f.firstXY=null,c.preventDefault()},d},processTouches:function(a,b){var d=a.changedTouches;this.currentTouchEvent=a;for(var e,f,g=0;g<d.length;g++)e=d[g],f=this.touchToPointer(e),"touchstart"===a.type&&c.set(f.pointerId,f.target),c.has(f.pointerId)&&b.call(this,f),("touchend"===a.type||a._cancel)&&this.cleanUpPointer(f)},shouldScroll:function(b){if(this.firstXY){var c,d=a.targetFinding.findTouchAction(b),e=this.touchActionToScrollType(d);if("none"===e)c=!1;else if("XY"===e)c=!0;else{var f=b.changedTouches[0],g=e,h="Y"===e?"X":"Y",i=Math.abs(f["client"+g]-this.firstXY[g]),j=Math.abs(f["client"+h]-this.firstXY[h]);c=i>=j}return c}},findTouch:function(a,b){for(var c,d=0,e=a.length;e>d&&(c=a[d]);d++)if(c.identifier===b)return!0},vacuumTouches:function(a){var b=a.touches;if(c.pointers()>=b.length){var d=[];c.forEach(function(a,c){if(1!==c&&!this.findTouch(b,c-2)){var e=a;d.push(e)}},this),d.forEach(function(a){this.cancel(a),c["delete"](a.pointerId)},this)}},touchstart:function(a){this.vacuumTouches(a),this.setPrimaryTouch(a.changedTouches[0]),this.dedupSynthMouse(a),this.scrolling||(this.clickCount++,this.processTouches(a,this.down))},down:function(a){b.down(a)},touchmove:function(a){if(h)a.cancelable&&this.processTouches(a,this.move);else if(this.scrolling){if(this.firstXY){var b=a.changedTouches[0],c=b.clientX-this.firstXY.X,d=b.clientY-this.firstXY.Y,e=Math.sqrt(c*c+d*d);e>=g&&(this.touchcancel(a),this.scrolling=!0,this.firstXY=null)}}else null===this.scrolling&&this.shouldScroll(a)?this.scrolling=!0:(this.scrolling=!1,a.preventDefault(),this.processTouches(a,this.move))},move:function(a){b.move(a)},touchend:function(a){this.dedupSynthMouse(a),this.processTouches(a,this.up)},up:function(c){c.relatedTarget=a.findTarget(c),b.up(c)},cancel:function(a){b.cancel(a)},touchcancel:function(a){a._cancel=!0,this.processTouches(a,this.cancel)},cleanUpPointer:function(a){c["delete"](a.pointerId),this.removePrimaryPointer(a)},dedupSynthMouse:function(b){var c=a.mouseEvents.lastTouches,e=b.changedTouches[0];if(this.isPrimaryTouch(e)){var f={x:e.clientX,y:e.clientY};c.push(f);var g=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)}.bind(null,c,f);setTimeout(g,d)}}},j=Event.prototype.stopImmediatePropagation||Event.prototype.stopPropagation;document.addEventListener("click",function(b){var c=b.clientX,d=b.clientY,f=function(a){var b=Math.abs(c-a.x),f=Math.abs(d-a.y);return e>=b&&e>=f},g=a.mouseEvents.lastTouches.some(f),h=a.targetFinding.path(b);if(g){for(var k=0;k<h.length;k++)if(h[k]===i.firstTarget)return;b.preventDefault(),j.call(b)}},!0),a.touchEvents=i}(window.PolymerGestures),function(a){var b=a.dispatcher,c=b.pointermap,d=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,e={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],register:function(a){b.listen(a,this.events)},unregister:function(a){a.nodeType!==Node.DOCUMENT_NODE&&b.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;return c=b.cloneEvent(a),d&&(c.pointerType=this.POINTER_TYPES[a.pointerType]),c._source="ms",c},cleanup:function(a){c["delete"](a)},MSPointerDown:function(d){var e=this.prepareEvent(d);e.target=a.findTarget(d),c.set(d.pointerId,e.target),b.down(e)},MSPointerMove:function(a){var d=c.get(a.pointerId);if(d){var e=this.prepareEvent(a);e.target=d,b.move(e)}},MSPointerUp:function(d){var e=this.prepareEvent(d);e.relatedTarget=a.findTarget(d),e.target=c.get(e.pointerId),b.up(e),this.cleanup(d.pointerId)},MSPointerCancel:function(d){var e=this.prepareEvent(d);e.relatedTarget=a.findTarget(d),e.target=c.get(e.pointerId),b.cancel(e),this.cleanup(d.pointerId)}};a.msEvents=e}(window.PolymerGestures),function(a){var b=a.dispatcher,c=b.pointermap,d={events:["pointerdown","pointermove","pointerup","pointercancel"],prepareEvent:function(a){var c=b.cloneEvent(a);return c._source="pointer",c},register:function(a){b.listen(a,this.events)},unregister:function(a){a.nodeType!==Node.DOCUMENT_NODE&&b.unlisten(a,this.events)},cleanup:function(a){c["delete"](a)},pointerdown:function(d){var e=this.prepareEvent(d);e.target=a.findTarget(d),c.set(e.pointerId,e.target),b.down(e)},pointermove:function(a){var d=c.get(a.pointerId);if(d){var e=this.prepareEvent(a);e.target=d,b.move(e)}},pointerup:function(d){var e=this.prepareEvent(d);e.relatedTarget=a.findTarget(d),e.target=c.get(e.pointerId),b.up(e),this.cleanup(d.pointerId)},pointercancel:function(d){var e=this.prepareEvent(d);e.relatedTarget=a.findTarget(d),e.target=c.get(e.pointerId),b.cancel(e),this.cleanup(d.pointerId)}};a.pointerEvents=d}(window.PolymerGestures),function(a){var b=a.dispatcher,c=window.navigator;window.PointerEvent?b.registerSource("pointer",a.pointerEvents):c.msPointerEnabled?b.registerSource("ms",a.msEvents):(b.registerSource("mouse",a.mouseEvents),void 0!==window.ontouchstart&&b.registerSource("touch",a.touchEvents));var d=navigator.userAgent,e=d.match(/iPad|iPhone|iPod/)&&"ontouchstart"in window;b.IS_IOS=e,a.touchEvents.IS_IOS=e,b.register(document,!0)}(window.PolymerGestures),function(a){var b=a.dispatcher,c=a.eventFactory,d=new a.PointerMap,e={events:["down","move","up"],exposes:["trackstart","track","trackx","tracky","trackend"],defaultActions:{track:"none",trackx:"pan-y",tracky:"pan-x"},WIGGLE_THRESHOLD:4,clampDir:function(a){return a>0?1:-1},calcPositionDelta:function(a,b){var c=0,d=0;return a&&b&&(c=b.pageX-a.pageX,d=b.pageY-a.pageY),{x:c,y:d}},fireTrack:function(a,b,d){var e=d,f=this.calcPositionDelta(e.downEvent,b),g=this.calcPositionDelta(e.lastMoveEvent,b);if(g.x)e.xDirection=this.clampDir(g.x);else if("trackx"===a)return;if(g.y)e.yDirection=this.clampDir(g.y);else if("tracky"===a)return;var h={bubbles:!0,cancelable:!0,trackInfo:e.trackInfo,relatedTarget:b.relatedTarget,pointerType:b.pointerType,pointerId:b.pointerId,_source:"track"};"tracky"!==a&&(h.x=b.x,h.dx=f.x,h.ddx=g.x,h.clientX=b.clientX,h.pageX=b.pageX,h.screenX=b.screenX,h.xDirection=e.xDirection),"trackx"!==a&&(h.dy=f.y,h.ddy=g.y,h.y=b.y,h.clientY=b.clientY,h.pageY=b.pageY,h.screenY=b.screenY,h.yDirection=e.yDirection);var i=c.makeGestureEvent(a,h);e.downTarget.dispatchEvent(i)},down:function(a){if(a.isPrimary&&("mouse"===a.pointerType?1===a.buttons:!0)){var b={downEvent:a,downTarget:a.target,trackInfo:{},lastMoveEvent:null,xDirection:0,yDirection:0,tracking:!1};d.set(a.pointerId,b)}},move:function(a){var b=d.get(a.pointerId);if(b){if(!b.tracking){var c=this.calcPositionDelta(b.downEvent,a),e=c.x*c.x+c.y*c.y;e>this.WIGGLE_THRESHOLD&&(b.tracking=!0,b.lastMoveEvent=b.downEvent,this.fireTrack("trackstart",a,b))}b.tracking&&(this.fireTrack("track",a,b),this.fireTrack("trackx",a,b),this.fireTrack("tracky",a,b)),b.lastMoveEvent=a}},up:function(a){var b=d.get(a.pointerId);b&&(b.tracking&&this.fireTrack("trackend",a,b),d["delete"](a.pointerId))}};b.registerGesture("track",e)}(window.PolymerGestures),function(a){var b=a.dispatcher,c=a.eventFactory,d={HOLD_DELAY:200,WIGGLE_THRESHOLD:16,events:["down","move","up"],exposes:["hold","holdpulse","release"],heldPointer:null,holdJob:null,pulse:function(){var a=Date.now()-this.heldPointer.timeStamp,b=this.held?"holdpulse":"hold";this.fireHold(b,a),this.held=!0},cancel:function(){clearInterval(this.holdJob),this.held&&this.fireHold("release"),this.held=!1,this.heldPointer=null,this.target=null,this.holdJob=null},down:function(a){a.isPrimary&&!this.heldPointer&&(this.heldPointer=a,this.target=a.target,this.holdJob=setInterval(this.pulse.bind(this),this.HOLD_DELAY))},up:function(a){this.heldPointer&&this.heldPointer.pointerId===a.pointerId&&this.cancel()},move:function(a){if(this.heldPointer&&this.heldPointer.pointerId===a.pointerId){var b=a.clientX-this.heldPointer.clientX,c=a.clientY-this.heldPointer.clientY;b*b+c*c>this.WIGGLE_THRESHOLD&&this.cancel()}},fireHold:function(a,b){var d={bubbles:!0,cancelable:!0,pointerType:this.heldPointer.pointerType,pointerId:this.heldPointer.pointerId,x:this.heldPointer.clientX,y:this.heldPointer.clientY,_source:"hold"};b&&(d.holdTime=b);var e=c.makeGestureEvent(a,d);this.target.dispatchEvent(e)}};b.registerGesture("hold",d)}(window.PolymerGestures),function(a){var b=a.dispatcher,c=a.eventFactory,d=new a.PointerMap,e={events:["down","up"],exposes:["tap"],down:function(a){a.isPrimary&&!a.tapPrevented&&d.set(a.pointerId,{target:a.target,buttons:a.buttons,x:a.clientX,y:a.clientY})},shouldTap:function(a,b){var c=!0;return"mouse"===a.pointerType&&(c=1^a.buttons&&1&b.buttons),c&&!a.tapPrevented},up:function(b){var e=d.get(b.pointerId);if(e&&this.shouldTap(b,e)){var f=a.targetFinding.LCA(e.target,b.relatedTarget);if(f){var g=c.makeGestureEvent("tap",{bubbles:!0,cancelable:!0,x:b.clientX,y:b.clientY,detail:b.detail,pointerType:b.pointerType,pointerId:b.pointerId,altKey:b.altKey,ctrlKey:b.ctrlKey,metaKey:b.metaKey,shiftKey:b.shiftKey,_source:"tap"});f.dispatchEvent(g)}}d["delete"](b.pointerId)}};c.preventTap=function(a){return function(){a.tapPrevented=!0,d["delete"](a.pointerId)}},b.registerGesture("tap",e)}(window.PolymerGestures),function(a){var b=a.dispatcher,c=a.eventFactory,d=new a.PointerMap,e=180/Math.PI,f={events:["down","up","move","cancel"],exposes:["pinchstart","pinch","pinchend","rotate"],defaultActions:{pinch:"none",rotate:"none"},reference:{},down:function(b){if(d.set(b.pointerId,b),2==d.pointers()){var c=this.calcChord(),e=this.calcAngle(c);this.reference={angle:e,diameter:c.diameter,target:a.targetFinding.LCA(c.a.target,c.b.target)},this.firePinch("pinchstart",c.diameter,c)}},up:function(a){var b=d.get(a.pointerId),c=d.pointers();if(b){if(2===c){var e=this.calcChord();this.firePinch("pinchend",e.diameter,e)}d["delete"](a.pointerId)}},move:function(a){d.has(a.pointerId)&&(d.set(a.pointerId,a),d.pointers()>1&&this.calcPinchRotate())},cancel:function(a){this.up(a)},firePinch:function(a,b,d){var e=b/this.reference.diameter,f=c.makeGestureEvent(a,{bubbles:!0,cancelable:!0,scale:e,centerX:d.center.x,centerY:d.center.y,_source:"pinch"});this.reference.target.dispatchEvent(f)},fireRotate:function(a,b){var d=Math.round((a-this.reference.angle)%360),e=c.makeGestureEvent("rotate",{bubbles:!0,cancelable:!0,angle:d,centerX:b.center.x,centerY:b.center.y,_source:"pinch"});this.reference.target.dispatchEvent(e)},calcPinchRotate:function(){var a=this.calcChord(),b=a.diameter,c=this.calcAngle(a);b!=this.reference.diameter&&this.firePinch("pinch",b,a),c!=this.reference.angle&&this.fireRotate(c,a)},calcChord:function(){var a=[];d.forEach(function(b){a.push(b)});for(var b,c,e,f=0,g={a:a[0],b:a[1]},h=0;h<a.length;h++)for(var i=a[h],j=h+1;j<a.length;j++){var k=a[j];b=Math.abs(i.clientX-k.clientX),c=Math.abs(i.clientY-k.clientY),e=b+c,e>f&&(f=e,g={a:i,b:k})}return b=Math.abs(g.a.clientX+g.b.clientX)/2,c=Math.abs(g.a.clientY+g.b.clientY)/2,g.center={x:b,y:c},g.diameter=f,g},calcAngle:function(a){var b=a.a.clientX-a.b.clientX,c=a.a.clientY-a.b.clientY;return(360+Math.atan2(c,b)*e)%360}};b.registerGesture("pinch",f)}(window.PolymerGestures);(function(root,factory){if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.SVG=factory()}})(this,function(){var SVG=this.SVG=function(element){if(SVG.supported){element=new SVG.Doc(element);if(!SVG.parser)SVG.prepare(element);return element}};SVG.ns="http://www.w3.org/2000/svg";SVG.xmlns="http://www.w3.org/2000/xmlns/";SVG.xlink="http://www.w3.org/1999/xlink";SVG.did=1e3;SVG.eid=function(name){return"Svgjs"+name.charAt(0).toUpperCase()+name.slice(1)+SVG.did++};SVG.create=function(name){var element=document.createElementNS(this.ns,name);element.setAttribute("id",this.eid(name));return element};SVG.extend=function(){var modules,methods,key,i;modules=[].slice.call(arguments);methods=modules.pop();for(i=modules.length-1;i>=0;i--)if(modules[i])for(key in methods)modules[i].prototype[key]=methods[key];if(SVG.Set&&SVG.Set.inherit)SVG.Set.inherit()};SVG.prepare=function(element){var body=document.getElementsByTagName("body")[0],draw=(body?new SVG.Doc(body):element.nested()).size(2,0),path=SVG.create("path");draw.node.appendChild(path);SVG.parser={body:body||element.parent,draw:draw.style("opacity:0;position:fixed;left:100%;top:100%;overflow:hidden"),poly:draw.polyline().node,path:path}};SVG.supported=function(){return!!document.createElementNS&&!!document.createElementNS(SVG.ns,"svg").createSVGRect}();if(!SVG.supported)return false;SVG.get=function(id){var node=document.getElementById(idFromReference(id)||id);if(node)return node.instance};SVG.invent=function(config){var initializer=typeof config.create=="function"?config.create:function(){this.constructor.call(this,SVG.create(config.create))};if(config.inherit)initializer.prototype=new config.inherit;if(config.extend)SVG.extend(initializer,config.extend);if(config.construct)SVG.extend(config.parent||SVG.Container,config.construct);return initializer};if(typeof CustomEvent!=="function"){function CustomEvent(event,options){options=options||{bubbles:false,cancelable:false,detail:undefined};var e=document.createEvent("CustomEvent");e.initCustomEvent(event,options.bubbles,options.cancelable,options.detail);return e}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent}(function(w){var lastTime=0;var vendors=["moz","webkit"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){w.requestAnimationFrame=w[vendors[x]+"RequestAnimationFrame"];w.cancelAnimationFrame=w[vendors[x]+"CancelAnimationFrame"]||w[vendors[x]+"CancelRequestAnimationFrame"]}w.requestAnimationFrame=w.requestAnimationFrame||function(callback){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=w.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};w.cancelAnimationFrame=w.cancelAnimationFrame||w.clearTimeout})(window);SVG.regex={unit:/^(-?[\d\.]+)([a-z%]{0,2})$/,hex:/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgb:/rgb\((\d+),(\d+),(\d+)\)/,reference:/#([a-z0-9\-_]+)/i,isHex:/^#[a-f0-9]{3,6}$/i,isRgb:/^rgb\(/,isCss:/[^:]+:[^;]+;?/,isBlank:/^(\s+)?$/,isNumber:/^-?[\d\.]+$/,isPercent:/^-?[\d\.]+%$/,isImage:/\.(jpg|jpeg|png|gif)(\?[^=]+.*)?/i,isEvent:/^[\w]+:[\w]+$/};SVG.defaults={matrix:"1 0 0 1 0 0",attrs:{"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","font-size":16,"font-family":"Helvetica, Arial, sans-serif","text-anchor":"start"},trans:function(){return{x:0,y:0,scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0,matrix:this.matrix,a:1,b:0,c:0,d:1,e:0,f:0}}};SVG.Color=function(color){var match;this.r=0;this.g=0;this.b=0;if(typeof color==="string"){if(SVG.regex.isRgb.test(color)){match=SVG.regex.rgb.exec(color.replace(/\s/g,""));this.r=parseInt(match[1]);this.g=parseInt(match[2]);this.b=parseInt(match[3])}else if(SVG.regex.isHex.test(color)){match=SVG.regex.hex.exec(fullHex(color));this.r=parseInt(match[1],16);this.g=parseInt(match[2],16);this.b=parseInt(match[3],16)}}else if(typeof color==="object"){this.r=color.r;this.g=color.g;this.b=color.b}};SVG.extend(SVG.Color,{toString:function(){return this.toHex()},toHex:function(){return"#"+compToHex(this.r)+compToHex(this.g)+compToHex(this.b)},toRgb:function(){return"rgb("+[this.r,this.g,this.b].join()+")"},brightness:function(){return this.r/255*.3+this.g/255*.59+this.b/255*.11},morph:function(color){this.destination=new SVG.Color(color);return this},at:function(pos){if(!this.destination)return this;pos=pos<0?0:pos>1?1:pos;return new SVG.Color({r:~~(this.r+(this.destination.r-this.r)*pos),g:~~(this.g+(this.destination.g-this.g)*pos),b:~~(this.b+(this.destination.b-this.b)*pos)})}});SVG.Color.test=function(color){color+="";return SVG.regex.isHex.test(color)||SVG.regex.isRgb.test(color)};SVG.Color.isRgb=function(color){return color&&typeof color.r=="number"&&typeof color.g=="number"&&typeof color.b=="number"};SVG.Color.isColor=function(color){return SVG.Color.isRgb(color)||SVG.Color.test(color)};SVG.Array=function(array,fallback){array=(array||[]).valueOf();if(array.length==0&&fallback)array=fallback.valueOf();this.value=this.parse(array)};SVG.extend(SVG.Array,{morph:function(array){this.destination=this.parse(array);if(this.value.length!=this.destination.length){var lastValue=this.value[this.value.length-1],lastDestination=this.destination[this.destination.length-1];while(this.value.length>this.destination.length)this.destination.push(lastDestination);while(this.value.length<this.destination.length)this.value.push(lastValue)}return this},settle:function(){for(var i=0,il=this.value.length,seen=[];i<il;i++)if(seen.indexOf(this.value[i])==-1)seen.push(this.value[i]);return this.value=seen},at:function(pos){if(!this.destination)return this;for(var i=0,il=this.value.length,array=[];i<il;i++)array.push(this.value[i]+(this.destination[i]-this.value[i])*pos);return new SVG.Array(array)},toString:function(){return this.value.join(" ")},valueOf:function(){return this.value},parse:function(array){array=array.valueOf();if(Array.isArray(array))return array;return this.split(array)},split:function(string){return string.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").split(" ")},reverse:function(){this.value.reverse();return this}});SVG.PointArray=function(){this.constructor.apply(this,arguments)};SVG.PointArray.prototype=new SVG.Array;SVG.extend(SVG.PointArray,{toString:function(){for(var i=0,il=this.value.length,array=[];i<il;i++)array.push(this.value[i].join(","));return array.join(" ")},at:function(pos){if(!this.destination)return this;for(var i=0,il=this.value.length,array=[];i<il;i++)array.push([this.value[i][0]+(this.destination[i][0]-this.value[i][0])*pos,this.value[i][1]+(this.destination[i][1]-this.value[i][1])*pos]);return new SVG.PointArray(array)},parse:function(array){array=array.valueOf();if(Array.isArray(array))return array;array=this.split(array);for(var i=0,il=array.length,p,points=[];i<il;i++){p=array[i].split(",");points.push([parseFloat(p[0]),parseFloat(p[1])])}return points},move:function(x,y){
var box=this.bbox();x-=box.x;y-=box.y;if(!isNaN(x)&&!isNaN(y))for(var i=this.value.length-1;i>=0;i--)this.value[i]=[this.value[i][0]+x,this.value[i][1]+y];return this},size:function(width,height){var i,box=this.bbox();for(i=this.value.length-1;i>=0;i--){this.value[i][0]=(this.value[i][0]-box.x)*width/box.width+box.x;this.value[i][1]=(this.value[i][1]-box.y)*height/box.height+box.y}return this},bbox:function(){SVG.parser.poly.setAttribute("points",this.toString());return SVG.parser.poly.getBBox()}});SVG.PathArray=function(array,fallback){this.constructor.call(this,array,fallback)};SVG.PathArray.prototype=new SVG.Array;SVG.extend(SVG.PathArray,{toString:function(){return arrayToString(this.value)},move:function(x,y){var box=this.bbox();x-=box.x;y-=box.y;if(!isNaN(x)&&!isNaN(y)){for(var l,i=this.value.length-1;i>=0;i--){l=this.value[i][0];if(l=="M"||l=="L"||l=="T"){this.value[i][1]+=x;this.value[i][2]+=y}else if(l=="H"){this.value[i][1]+=x}else if(l=="V"){this.value[i][1]+=y}else if(l=="C"||l=="S"||l=="Q"){this.value[i][1]+=x;this.value[i][2]+=y;this.value[i][3]+=x;this.value[i][4]+=y;if(l=="C"){this.value[i][5]+=x;this.value[i][6]+=y}}else if(l=="A"){this.value[i][6]+=x;this.value[i][7]+=y}}}return this},size:function(width,height){var i,l,box=this.bbox();for(i=this.value.length-1;i>=0;i--){l=this.value[i][0];if(l=="M"||l=="L"||l=="T"){this.value[i][1]=(this.value[i][1]-box.x)*width/box.width+box.x;this.value[i][2]=(this.value[i][2]-box.y)*height/box.height+box.y}else if(l=="H"){this.value[i][1]=(this.value[i][1]-box.x)*width/box.width+box.x}else if(l=="V"){this.value[i][1]=(this.value[i][1]-box.y)*height/box.height+box.y}else if(l=="C"||l=="S"||l=="Q"){this.value[i][1]=(this.value[i][1]-box.x)*width/box.width+box.x;this.value[i][2]=(this.value[i][2]-box.y)*height/box.height+box.y;this.value[i][3]=(this.value[i][3]-box.x)*width/box.width+box.x;this.value[i][4]=(this.value[i][4]-box.y)*height/box.height+box.y;if(l=="C"){this.value[i][5]=(this.value[i][5]-box.x)*width/box.width+box.x;this.value[i][6]=(this.value[i][6]-box.y)*height/box.height+box.y}}else if(l=="A"){this.value[i][1]=this.value[i][1]*width/box.width;this.value[i][2]=this.value[i][2]*height/box.height;this.value[i][6]=(this.value[i][6]-box.x)*width/box.width+box.x;this.value[i][7]=(this.value[i][7]-box.y)*height/box.height+box.y}}return this},parse:function(array){if(array instanceof SVG.PathArray)return array.valueOf();var i,il,x0,y0,x1,y1,x2,y2,s,seg,segs,x=0,y=0;SVG.parser.path.setAttribute("d",typeof array==="string"?array:arrayToString(array));segs=SVG.parser.path.pathSegList;for(i=0,il=segs.numberOfItems;i<il;++i){seg=segs.getItem(i);s=seg.pathSegTypeAsLetter;if(s=="M"||s=="L"||s=="H"||s=="V"||s=="C"||s=="S"||s=="Q"||s=="T"||s=="A"){if("x"in seg)x=seg.x;if("y"in seg)y=seg.y}else{if("x1"in seg)x1=x+seg.x1;if("x2"in seg)x2=x+seg.x2;if("y1"in seg)y1=y+seg.y1;if("y2"in seg)y2=y+seg.y2;if("x"in seg)x+=seg.x;if("y"in seg)y+=seg.y;if(s=="m")segs.replaceItem(SVG.parser.path.createSVGPathSegMovetoAbs(x,y),i);else if(s=="l")segs.replaceItem(SVG.parser.path.createSVGPathSegLinetoAbs(x,y),i);else if(s=="h")segs.replaceItem(SVG.parser.path.createSVGPathSegLinetoHorizontalAbs(x),i);else if(s=="v")segs.replaceItem(SVG.parser.path.createSVGPathSegLinetoVerticalAbs(y),i);else if(s=="c")segs.replaceItem(SVG.parser.path.createSVGPathSegCurvetoCubicAbs(x,y,x1,y1,x2,y2),i);else if(s=="s")segs.replaceItem(SVG.parser.path.createSVGPathSegCurvetoCubicSmoothAbs(x,y,x2,y2),i);else if(s=="q")segs.replaceItem(SVG.parser.path.createSVGPathSegCurvetoQuadraticAbs(x,y,x1,y1),i);else if(s=="t")segs.replaceItem(SVG.parser.path.createSVGPathSegCurvetoQuadraticSmoothAbs(x,y),i);else if(s=="a")segs.replaceItem(SVG.parser.path.createSVGPathSegArcAbs(x,y,seg.r1,seg.r2,seg.angle,seg.largeArcFlag,seg.sweepFlag),i);else if(s=="z"||s=="Z"){x=x0;y=y0}}if(s=="M"||s=="m"){x0=x;y0=y}}array=[];segs=SVG.parser.path.pathSegList;for(i=0,il=segs.numberOfItems;i<il;++i){seg=segs.getItem(i);s=seg.pathSegTypeAsLetter;x=[s];if(s=="M"||s=="L"||s=="T")x.push(seg.x,seg.y);else if(s=="H")x.push(seg.x);else if(s=="V")x.push(seg.y);else if(s=="C")x.push(seg.x1,seg.y1,seg.x2,seg.y2,seg.x,seg.y);else if(s=="S")x.push(seg.x2,seg.y2,seg.x,seg.y);else if(s=="Q")x.push(seg.x1,seg.y1,seg.x,seg.y);else if(s=="A")x.push(seg.r1,seg.r2,seg.angle,seg.largeArcFlag|0,seg.sweepFlag|0,seg.x,seg.y);array.push(x)}return array},bbox:function(){SVG.parser.path.setAttribute("d",this.toString());return SVG.parser.path.getBBox()}});SVG.Number=function(value){this.value=0;this.unit="";if(typeof value==="number"){this.value=isNaN(value)?0:!isFinite(value)?value<0?-3.4e38:+3.4e38:value}else if(typeof value==="string"){var match=value.match(SVG.regex.unit);if(match){this.value=parseFloat(match[1]);if(match[2]=="%")this.value/=100;else if(match[2]=="s")this.value*=1e3;this.unit=match[2]}}else{if(value instanceof SVG.Number){this.value=value.value;this.unit=value.unit}}};SVG.extend(SVG.Number,{toString:function(){return(this.unit=="%"?~~(this.value*1e8)/1e6:this.unit=="s"?this.value/1e3:this.value)+this.unit},valueOf:function(){return this.value},plus:function(number){this.value=this+new SVG.Number(number);return this},minus:function(number){return this.plus(-new SVG.Number(number))},times:function(number){this.value=this*new SVG.Number(number);return this},divide:function(number){this.value=this/new SVG.Number(number);return this},to:function(unit){if(typeof unit==="string")this.unit=unit;return this},morph:function(number){this.destination=new SVG.Number(number);return this},at:function(pos){if(!this.destination)return this;return new SVG.Number(this.destination).minus(this).times(pos).plus(this)}});SVG.ViewBox=function(element){var x,y,width,height,wm=1,hm=1,box=element.bbox(),view=(element.attr("viewBox")||"").match(/-?[\d\.]+/g),we=element,he=element;width=new SVG.Number(element.width());height=new SVG.Number(element.height());while(width.unit=="%"){wm*=width.value;width=new SVG.Number(we instanceof SVG.Doc?we.parent.offsetWidth:we.parent.width());we=we.parent}while(height.unit=="%"){hm*=height.value;height=new SVG.Number(he instanceof SVG.Doc?he.parent.offsetHeight:he.parent.height());he=he.parent}this.x=box.x;this.y=box.y;this.width=width*wm;this.height=height*hm;this.zoom=1;if(view){x=parseFloat(view[0]);y=parseFloat(view[1]);width=parseFloat(view[2]);height=parseFloat(view[3]);this.zoom=this.width/this.height>width/height?this.height/height:this.width/width;this.x=x;this.y=y;this.width=width;this.height=height}};SVG.extend(SVG.ViewBox,{toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height}});SVG.BBox=function(element){var box;this.x=0;this.y=0;this.width=0;this.height=0;if(element){try{box=element.node.getBBox()}catch(e){box={x:element.node.clientLeft,y:element.node.clientTop,width:element.node.clientWidth,height:element.node.clientHeight}}this.x=box.x+element.trans.x;this.y=box.y+element.trans.y;this.width=box.width*element.trans.scaleX;this.height=box.height*element.trans.scaleY}boxProperties(this)};SVG.extend(SVG.BBox,{merge:function(box){var b=new SVG.BBox;b.x=Math.min(this.x,box.x);b.y=Math.min(this.y,box.y);b.width=Math.max(this.x+this.width,box.x+box.width)-b.x;b.height=Math.max(this.y+this.height,box.y+box.height)-b.y;boxProperties(b);return b}});SVG.RBox=function(element){var e,zoom,box={};this.x=0;this.y=0;this.width=0;this.height=0;if(element){e=element.doc().parent;zoom=element.doc().viewbox().zoom;box=element.node.getBoundingClientRect();this.x=box.left;this.y=box.top;this.x-=e.offsetLeft;this.y-=e.offsetTop;while(e=e.offsetParent){this.x-=e.offsetLeft;this.y-=e.offsetTop}e=element;while(e=e.parent){if(e.type=="svg"&&e.viewbox){zoom*=e.viewbox().zoom;this.x-=e.x()||0;this.y-=e.y()||0}}}this.x/=zoom;this.y/=zoom;this.width=box.width/=zoom;this.height=box.height/=zoom;this.x+=typeof window.scrollX==="number"?window.scrollX:window.pageXOffset;this.y+=typeof window.scrollY==="number"?window.scrollY:window.pageYOffset;boxProperties(this)};SVG.extend(SVG.RBox,{merge:function(box){var b=new SVG.RBox;b.x=Math.min(this.x,box.x);b.y=Math.min(this.y,box.y);b.width=Math.max(this.x+this.width,box.x+box.width)-b.x;b.height=Math.max(this.y+this.height,box.y+box.height)-b.y;boxProperties(b);return b}});SVG.Element=SVG.invent({create:function(node){this._stroke=SVG.defaults.attrs.stroke;this.trans=SVG.defaults.trans();if(this.node=node){this.type=node.nodeName;this.node.instance=this}},extend:{x:function(x){if(x!=null){x=new SVG.Number(x);x.value/=this.trans.scaleX}return this.attr("x",x)},y:function(y){if(y!=null){y=new SVG.Number(y);y.value/=this.trans.scaleY}return this.attr("y",y)},cx:function(x){return x==null?this.x()+this.width()/2:this.x(x-this.width()/2)},cy:function(y){return y==null?this.y()+this.height()/2:this.y(y-this.height()/2)},move:function(x,y){return this.x(x).y(y)},center:function(x,y){return this.cx(x).cy(y)},width:function(width){return this.attr("width",width)},height:function(height){return this.attr("height",height)},size:function(width,height){var p=proportionalSize(this.bbox(),width,height);return this.width(new SVG.Number(p.width)).height(new SVG.Number(p.height))},clone:function(){var clone,attr,type=this.type;clone=type=="rect"||type=="ellipse"?this.parent[type](0,0):type=="line"?this.parent[type](0,0,0,0):type=="image"?this.parent[type](this.src):type=="text"?this.parent[type](this.content):type=="path"?this.parent[type](this.attr("d")):type=="polyline"||type=="polygon"?this.parent[type](this.attr("points")):type=="g"?this.parent.group():this.parent[type]();attr=this.attr();delete attr.id;clone.attr(attr);clone.trans=this.trans;return clone.transform({})},remove:function(){if(this.parent)this.parent.removeElement(this);return this},replace:function(element){this.after(element).remove();return element},addTo:function(parent){return parent.put(this)},putIn:function(parent){return parent.add(this)},doc:function(type){return this._parent(type||SVG.Doc)},attr:function(a,v,n){if(a==null){a={};v=this.node.attributes;for(n=v.length-1;n>=0;n--)a[v[n].nodeName]=SVG.regex.isNumber.test(v[n].nodeValue)?parseFloat(v[n].nodeValue):v[n].nodeValue;return a}else if(typeof a=="object"){for(v in a)this.attr(v,a[v])}else if(v===null){this.node.removeAttribute(a)}else if(v==null){v=this.node.attributes[a];return v==null?SVG.defaults.attrs[a]:SVG.regex.isNumber.test(v.nodeValue)?parseFloat(v.nodeValue):v.nodeValue}else if(a=="style"){return this.style(v)}else{if(a=="stroke-width")this.attr("stroke",parseFloat(v)>0?this._stroke:null);else if(a=="stroke")this._stroke=v;if(a=="fill"||a=="stroke"){if(SVG.regex.isImage.test(v))v=this.doc().defs().image(v,0,0);if(v instanceof SVG.Image)v=this.doc().defs().pattern(0,0,function(){this.add(v)})}if(typeof v==="number")v=new SVG.Number(v);else if(SVG.Color.isColor(v))v=new SVG.Color(v);else if(Array.isArray(v))v=new SVG.Array(v);if(a=="leading"){if(this.leading)this.leading(v)}else{typeof n==="string"?this.node.setAttributeNS(n,a,v.toString()):this.node.setAttribute(a,v.toString())}if(this.rebuild&&(a=="font-size"||a=="x"))this.rebuild(a,v)}return this},transform:function(o,v){if(arguments.length==0){return this.trans}else if(typeof o==="string"){if(arguments.length<2)return this.trans[o];var transform={};transform[o]=v;return this.transform(transform)}var transform=[];o=parseMatrix(o);for(v in o)if(o[v]!=null)this.trans[v]=o[v];this.trans.matrix=this.trans.a+" "+this.trans.b+" "+this.trans.c+" "+this.trans.d+" "+this.trans.e+" "+this.trans.f;o=this.trans;if(o.matrix!=SVG.defaults.matrix)transform.push("matrix("+o.matrix+")");if(o.rotation!=0)transform.push("rotate("+o.rotation+" "+(o.cx==null?this.bbox().cx:o.cx)+" "+(o.cy==null?this.bbox().cy:o.cy)+")");if(o.scaleX!=1||o.scaleY!=1)transform.push("scale("+o.scaleX+" "+o.scaleY+")");if(o.skewX!=0)transform.push("skewX("+o.skewX+")");if(o.skewY!=0)transform.push("skewY("+o.skewY+")");if(o.x!=0||o.y!=0)transform.push("translate("+new SVG.Number(o.x/o.scaleX)+" "+new SVG.Number(o.y/o.scaleY)+")");if(transform.length==0)this.node.removeAttribute("transform");else this.node.setAttribute("transform",transform.join(" "));return this},style:function(s,v){if(arguments.length==0){return this.node.style.cssText||""}else if(arguments.length<2){if(typeof s=="object"){for(v in s)this.style(v,s[v])}else if(SVG.regex.isCss.test(s)){s=s.split(";");for(var i=0;i<s.length;i++){v=s[i].split(":");this.style(v[0].replace(/\s+/g,""),v[1])}}else{return this.node.style[camelCase(s)]}}else{this.node.style[camelCase(s)]=v===null||SVG.regex.isBlank.test(v)?"":v}return this},id:function(id){return this.attr("id",id)},bbox:function(){return new SVG.BBox(this)},rbox:function(){return new SVG.RBox(this)},inside:function(x,y){var box=this.bbox();return x>box.x&&y>box.y&&x<box.x+box.width&&y<box.y+box.height},show:function(){return this.style("display","")},hide:function(){return this.style("display","none")},visible:function(){return this.style("display")!="none"},toString:function(){return this.attr("id")},classes:function(){var classAttr=this.node.getAttribute("class");if(classAttr===null){return[]}else{return classAttr.trim().split(/\s+/)}},hasClass:function(className){return this.classes().indexOf(className)!=-1},addClass:function(className){var classArray;if(!this.hasClass(className)){classArray=this.classes();classArray.push(className);this.node.setAttribute("class",classArray.join(" "))}return this},removeClass:function(className){var classArray;if(this.hasClass(className)){classArray=this.classes().filter(function(c){return c!=className});this.node.setAttribute("class",classArray.join(" "))}return this},toggleClass:function(className){if(this.hasClass(className)){this.removeClass(className)}else{this.addClass(className)}return this},reference:function(attr){return SVG.get(this.attr()[attr])},_parent:function(parent){var element=this;while(element!=null&&!(element instanceof parent))element=element.parent;return element}}});SVG.Parent=SVG.invent({create:function(element){this.constructor.call(this,element)},inherit:SVG.Element,extend:{children:function(){return this._children||(this._children=[])},add:function(element,i){if(!this.has(element)){i=i==null?this.children().length:i;if(element.parent)element.parent.children().splice(element.parent.index(element),1);this.children().splice(i,0,element);this.node.insertBefore(element.node,this.node.childNodes[i]||null);element.parent=this}if(this._defs){this.node.removeChild(this._defs.node);this.node.appendChild(this._defs.node)}return this},put:function(element,i){this.add(element,i);return element},has:function(element){return this.index(element)>=0},index:function(element){return this.children().indexOf(element)},get:function(i){return this.children()[i]},first:function(){return this.children()[0]},last:function(){return this.children()[this.children().length-1]},each:function(block,deep){var i,il,children=this.children();for(i=0,il=children.length;i<il;i++){if(children[i]instanceof SVG.Element)block.apply(children[i],[i,children]);if(deep&&children[i]instanceof SVG.Container)children[i].each(block,deep)}return this},removeElement:function(element){this.children().splice(this.index(element),1);this.node.removeChild(element.node);element.parent=null;return this},clear:function(){for(var i=this.children().length-1;i>=0;i--)this.removeElement(this.children()[i]);if(this._defs)this._defs.clear();return this},defs:function(){return this.doc().defs()}}});SVG.Container=SVG.invent({create:function(element){this.constructor.call(this,element)},inherit:SVG.Parent,extend:{viewbox:function(v){if(arguments.length==0)return new SVG.ViewBox(this);v=arguments.length==1?[v.x,v.y,v.width,v.height]:[].slice.call(arguments);return this.attr("viewBox",v)}}});SVG.FX=SVG.invent({create:function(element){this.target=element},extend:{animate:function(d,ease,delay){var akeys,tkeys,skeys,key,element=this.target,fx=this;if(typeof d=="object"){delay=d.delay;ease=d.ease;d=d.duration}d=d=="="?d:d==null?1e3:new SVG.Number(d).valueOf();ease=ease||"<>";fx.to=function(pos){var i;pos=pos<0?0:pos>1?1:pos;if(akeys==null){akeys=[];for(key in fx.attrs)akeys.push(key);if(element.morphArray&&(fx._plot||akeys.indexOf("points")>-1)){var box,p=new element.morphArray(fx._plot||fx.attrs.points||element.array);if(fx._size)p.size(fx._size.width.to,fx._size.height.to);box=p.bbox();if(fx._x)p.move(fx._x.to,box.y);else if(fx._cx)p.move(fx._cx.to-box.width/2,box.y);box=p.bbox();if(fx._y)p.move(box.x,fx._y.to);else if(fx._cy)p.move(box.x,fx._cy.to-box.height/2);delete fx._x;delete fx._y;delete fx._cx;delete fx._cy;delete fx._size;fx._plot=element.array.morph(p)}}if(tkeys==null){tkeys=[];for(key in fx.trans)tkeys.push(key)}if(skeys==null){skeys=[];for(key in fx.styles)skeys.push(key)}pos=ease=="<>"?-Math.cos(pos*Math.PI)/2+.5:ease==">"?Math.sin(pos*Math.PI/2):ease=="<"?-Math.cos(pos*Math.PI/2)+1:ease=="-"?pos:typeof ease=="function"?ease(pos):pos;if(fx._plot){element.plot(fx._plot.at(pos))}else{if(fx._x)element.x(fx._x.at(pos));else if(fx._cx)element.cx(fx._cx.at(pos));if(fx._y)element.y(fx._y.at(pos));else if(fx._cy)element.cy(fx._cy.at(pos));if(fx._size)element.size(fx._size.width.at(pos),fx._size.height.at(pos))}if(fx._viewbox)element.viewbox(fx._viewbox.x.at(pos),fx._viewbox.y.at(pos),fx._viewbox.width.at(pos),fx._viewbox.height.at(pos));if(fx._leading)element.leading(fx._leading.at(pos));for(i=akeys.length-1;i>=0;i--)element.attr(akeys[i],at(fx.attrs[akeys[i]],pos));for(i=tkeys.length-1;i>=0;i--)element.transform(tkeys[i],at(fx.trans[tkeys[i]],pos));for(i=skeys.length-1;i>=0;i--)element.style(skeys[i],at(fx.styles[skeys[i]],pos));if(fx._during)fx._during.call(element,pos,function(from,to){return at({from:from,to:to},pos)})};if(typeof d==="number"){this.timeout=setTimeout(function(){var start=(new Date).getTime();fx.situation={interval:1e3/60,start:start,play:true,finish:start+d,duration:d};fx.render=function(){if(fx.situation.play===true){var time=(new Date).getTime(),pos=time>fx.situation.finish?1:(time-fx.situation.start)/d;fx.to(pos);if(time>fx.situation.finish){if(fx._plot)element.plot(new SVG.PointArray(fx._plot.destination).settle());if(fx._loop===true||typeof fx._loop=="number"&&fx._loop>1){if(typeof fx._loop=="number")--fx._loop;fx.animate(d,ease,delay)}else{fx._after?fx._after.apply(element,[fx]):fx.stop()}}else{fx.animationFrame=requestAnimationFrame(fx.render)}}else{fx.animationFrame=requestAnimationFrame(fx.render)}};fx.render()},new SVG.Number(delay).valueOf())}return this},bbox:function(){return this.target.bbox()},attr:function(a,v){if(typeof a=="object"){for(var key in a)this.attr(key,a[key])}else{var from=this.target.attr(a);this.attrs[a]=SVG.Color.isColor(from)?new SVG.Color(from).morph(v):SVG.regex.unit.test(from)?new SVG.Number(from).morph(v):{from:from,to:v}}return this},transform:function(o,v){if(arguments.length==1){o=parseMatrix(o);delete o.matrix;this.target.trans.cx=o.cx||null;this.target.trans.cy=o.cy||null;delete o.cx;delete o.cy;for(v in o)this.trans[v]={from:this.target.trans[v],to:o[v]}}else{var transform={};transform[o]=v;this.transform(transform)}return this},style:function(s,v){if(typeof s=="object")for(var key in s)this.style(key,s[key]);else this.styles[s]={from:this.target.style(s),to:v};return this},x:function(x){this._x=new SVG.Number(this.target.x()).morph(x);return this},y:function(y){this._y=new SVG.Number(this.target.y()).morph(y);return this},cx:function(x){this._cx=new SVG.Number(this.target.cx()).morph(x);return this},cy:function(y){this._cy=new SVG.Number(this.target.cy()).morph(y);return this},move:function(x,y){return this.x(x).y(y)},center:function(x,y){return this.cx(x).cy(y)},size:function(width,height){if(this.target instanceof SVG.Text){this.attr("font-size",width)}else{var box=this.target.bbox();this._size={width:new SVG.Number(box.width).morph(width),height:new SVG.Number(box.height).morph(height)}}return this},plot:function(p){this._plot=p;return this},leading:function(value){if(this.target._leading)this._leading=new SVG.Number(this.target._leading).morph(value);return this},viewbox:function(x,y,width,height){if(this.target instanceof SVG.Container){var box=this.target.viewbox();this._viewbox={x:new SVG.Number(box.x).morph(x),y:new SVG.Number(box.y).morph(y),width:new SVG.Number(box.width).morph(width),height:new SVG.Number(box.height).morph(height)}}return this},update:function(o){if(this.target instanceof SVG.Stop){if(o.opacity!=null)this.attr("stop-opacity",o.opacity);if(o.color!=null)this.attr("stop-color",o.color);if(o.offset!=null)this.attr("offset",new SVG.Number(o.offset))}return this},during:function(during){this._during=during;return this},after:function(after){this._after=after;return this},loop:function(times){this._loop=times||true;return this},stop:function(fulfill){if(fulfill===true){this.animate(0);if(this._after)this._after.apply(this.target,[this])}else{clearTimeout(this.timeout);cancelAnimationFrame(this.animationFrame);this.attrs={};this.trans={};this.styles={};this.situation={};delete this._x;delete this._y;delete this._cx;delete this._cy;delete this._size;delete this._plot;delete this._loop;delete this._after;delete this._during;delete this._leading;delete this._viewbox}return this},pause:function(){if(this.situation.play===true){this.situation.play=false;this.situation.pause=(new Date).getTime()}return this},play:function(){if(this.situation.play===false){var pause=(new Date).getTime()-this.situation.pause;this.situation.finish+=pause;this.situation.start+=pause;this.situation.play=true}return this}},parent:SVG.Element,construct:{animate:function(d,ease,delay){return(this.fx||(this.fx=new SVG.FX(this))).stop().animate(d,ease,delay)},stop:function(fulfill){if(this.fx)this.fx.stop(fulfill);return this},pause:function(){if(this.fx)this.fx.pause();return this},play:function(){if(this.fx)this.fx.play();return this}}});SVG.extend(SVG.Element,SVG.FX,{dx:function(x){return this.x((this.target||this).x()+x)},dy:function(y){return this.y((this.target||this).y()+y)},dmove:function(x,y){return this.dx(x).dy(y)}});["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","touchstart","touchmove","touchleave","touchend","touchcancel"].forEach(function(event){SVG.Element.prototype[event]=function(f){var self=this;this.node["on"+event]=typeof f=="function"?function(){return f.apply(self,arguments)}:null;return this}});SVG.listeners=[];SVG.handlerMap=[];SVG.registerEvent=function(){};SVG.on=function(node,event,listener){var l=listener.bind(node.instance||node),index=(SVG.handlerMap.indexOf(node)+1||SVG.handlerMap.push(node))-1,ev=event.split(".")[0],ns=event.split(".")[1]||"*";SVG.listeners[index]=SVG.listeners[index]||{};SVG.listeners[index][ev]=SVG.listeners[index][ev]||{};SVG.listeners[index][ev][ns]=SVG.listeners[index][ev][ns]||{};SVG.listeners[index][ev][ns][listener]=l;node.addEventListener(ev,l,false)};SVG.off=function(node,event,listener){var index=SVG.handlerMap.indexOf(node),ev=event&&event.split(".")[0],ns=event&&event.split(".")[1];if(index==-1)return;if(listener){if(SVG.listeners[index][ev]&&SVG.listeners[index][ev][ns||"*"]){node.removeEventListener(ev,SVG.listeners[index][ev][ns||"*"][listener],false);delete SVG.listeners[index][ev][ns||"*"][listener]}}else if(ns){if(SVG.listeners[index][ev]&&SVG.listeners[index][ev][ns]){for(listener in SVG.listeners[index][ev][ns])SVG.off(node,[ev,ns].join("."),listener);delete SVG.listeners[index][ev][ns]}}else if(ev){if(SVG.listeners[index][ev]){for(namespace in SVG.listeners[index][ev])SVG.off(node,[ev,namespace].join("."));delete SVG.listeners[index][ev]}}else{for(event in SVG.listeners[index])SVG.off(node,event);delete SVG.listeners[index]}};SVG.extend(SVG.Element,{on:function(event,listener){SVG.on(this.node,event,listener);return this},off:function(event,listener){SVG.off(this.node,event,listener);return this},fire:function(event,data){this.node.dispatchEvent(new CustomEvent(event,{detail:data}));return this}});SVG.Defs=SVG.invent({create:"defs",inherit:SVG.Container});SVG.G=SVG.invent({create:"g",inherit:SVG.Container,extend:{x:function(x){return x==null?this.trans.x:this.transform("x",x)},y:function(y){return y==null?this.trans.y:this.transform("y",y)},cx:function(x){return x==null?this.bbox().cx:this.x(x-this.bbox().width/2)},cy:function(y){return y==null?this.bbox().cy:this.y(y-this.bbox().height/2)}},construct:{group:function(){return this.put(new SVG.G)}}});SVG.extend(SVG.Element,{siblings:function(){return this.parent.children()},position:function(){return this.parent.index(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){var i=this.position();return this.parent.removeElement(this).put(this,i+1)},backward:function(){var i=this.position();if(i>0)this.parent.removeElement(this).add(this,i-1);return this},front:function(){return this.parent.removeElement(this).put(this)},back:function(){if(this.position()>0)this.parent.removeElement(this).add(this,0);return this},before:function(element){element.remove();var i=this.position();this.parent.add(element,i);return this},after:function(element){element.remove();var i=this.position();this.parent.add(element,i+1);return this}});SVG.Mask=SVG.invent({create:function(){this.constructor.call(this,SVG.create("mask"));this.targets=[]},inherit:SVG.Container,extend:{remove:function(){for(var i=this.targets.length-1;i>=0;i--)if(this.targets[i])this.targets[i].unmask();delete this.targets;this.parent.removeElement(this);return this}},construct:{mask:function(){return this.defs().put(new SVG.Mask)}}});SVG.extend(SVG.Element,{maskWith:function(element){this.masker=element instanceof SVG.Mask?element:this.parent.mask().add(element);this.masker.targets.push(this);return this.attr("mask",'url("#'+this.masker.attr("id")+'")')},unmask:function(){delete this.masker;return this.attr("mask",null)}});SVG.Clip=SVG.invent({create:function(){this.constructor.call(this,SVG.create("clipPath"));this.targets=[]},inherit:SVG.Container,extend:{remove:function(){for(var i=this.targets.length-1;i>=0;i--)if(this.targets[i])this.targets[i].unclip();delete this.targets;this.parent.removeElement(this);return this}},construct:{clip:function(){return this.defs().put(new SVG.Clip)}}});SVG.extend(SVG.Element,{clipWith:function(element){this.clipper=element instanceof SVG.Clip?element:this.parent.clip().add(element);this.clipper.targets.push(this);return this.attr("clip-path",'url("#'+this.clipper.attr("id")+'")')},unclip:function(){delete this.clipper;return this.attr("clip-path",null)}});SVG.Gradient=SVG.invent({create:function(type){this.constructor.call(this,SVG.create(type+"Gradient"));this.type=type},inherit:SVG.Container,extend:{from:function(x,y){return this.type=="radial"?this.attr({fx:new SVG.Number(x),fy:new SVG.Number(y)}):this.attr({x1:new SVG.Number(x),y1:new SVG.Number(y)})},to:function(x,y){return this.type=="radial"?this.attr({cx:new SVG.Number(x),cy:new SVG.Number(y)}):this.attr({x2:new SVG.Number(x),y2:new SVG.Number(y)})},radius:function(r){return this.type=="radial"?this.attr({r:new SVG.Number(r)}):this},at:function(offset,color,opacity){return this.put(new SVG.Stop).update(offset,color,opacity)},update:function(block){this.clear();if(typeof block=="function")block.call(this,this);return this},fill:function(){return"url(#"+this.id()+")"},toString:function(){return this.fill()}},construct:{gradient:function(type,block){return this.defs().gradient(type,block)}}});SVG.extend(SVG.Defs,{gradient:function(type,block){return this.put(new SVG.Gradient(type)).update(block)}});SVG.Stop=SVG.invent({create:"stop",inherit:SVG.Element,extend:{update:function(o){if(typeof o=="number"||o instanceof SVG.Number){o={offset:arguments[0],color:arguments[1],opacity:arguments[2]}}if(o.opacity!=null)this.attr("stop-opacity",o.opacity);if(o.color!=null)this.attr("stop-color",o.color);if(o.offset!=null)this.attr("offset",new SVG.Number(o.offset));return this}}});SVG.Pattern=SVG.invent({create:"pattern",inherit:SVG.Container,extend:{fill:function(){return"url(#"+this.id()+")"},update:function(block){this.clear();if(typeof block=="function")block.call(this,this);return this},toString:function(){return this.fill()}},construct:{pattern:function(width,height,block){return this.defs().pattern(width,height,block)}}});SVG.extend(SVG.Defs,{pattern:function(width,height,block){return this.put(new SVG.Pattern).update(block).attr({x:0,y:0,width:width,height:height,patternUnits:"userSpaceOnUse"})}});SVG.Doc=SVG.invent({create:function(element){this.parent=typeof element=="string"?document.getElementById(element):element;this.constructor.call(this,this.parent.nodeName=="svg"?this.parent:SVG.create("svg"));this.attr({xmlns:SVG.ns,version:"1.1",width:"100%",height:"100%"}).attr("xmlns:xlink",SVG.xlink,SVG.xmlns);this._defs=new SVG.Defs;this._defs.parent=this;this.node.appendChild(this._defs.node);this.doSpof=false;if(this.parent!=this.node)this.stage()},inherit:SVG.Container,extend:{stage:function(){var element=this;this.parent.appendChild(this.node);element.spof();SVG.on(window,"resize",function(){element.spof()});return this},defs:function(){return this._defs},spof:function(){if(this.doSpof){var pos=this.node.getScreenCTM();if(pos)this.style("left",-pos.e%1+"px").style("top",-pos.f%1+"px")}return this},fixSubPixelOffset:function(){this.doSpof=true;return this},remove:function(){if(this.parent){this.parent.removeChild(this.node);this.parent=null}return this}}});SVG.Shape=SVG.invent({create:function(element){this.constructor.call(this,element)},inherit:SVG.Element});SVG.Symbol=SVG.invent({create:"symbol",inherit:SVG.Container,construct:{symbol:function(){return this.defs().put(new SVG.Symbol)}}});SVG.Use=SVG.invent({create:"use",inherit:SVG.Shape,extend:{element:function(element){this.target=element;return this.attr("href","#"+element,SVG.xlink)}},construct:{use:function(element){return this.put(new SVG.Use).element(element)}}});SVG.Rect=SVG.invent({create:"rect",inherit:SVG.Shape,construct:{rect:function(width,height){return this.put((new SVG.Rect).size(width,height))}}});SVG.Ellipse=SVG.invent({create:"ellipse",inherit:SVG.Shape,extend:{x:function(x){return x==null?this.cx()-this.attr("rx"):this.cx(x+this.attr("rx"))},y:function(y){return y==null?this.cy()-this.attr("ry"):this.cy(y+this.attr("ry"))},cx:function(x){return x==null?this.attr("cx"):this.attr("cx",new SVG.Number(x).divide(this.trans.scaleX))},cy:function(y){return y==null?this.attr("cy"):this.attr("cy",new SVG.Number(y).divide(this.trans.scaleY))},width:function(width){return width==null?this.attr("rx")*2:this.attr("rx",new SVG.Number(width).divide(2))},height:function(height){return height==null?this.attr("ry")*2:this.attr("ry",new SVG.Number(height).divide(2))},size:function(width,height){var p=proportionalSize(this.bbox(),width,height);return this.attr({rx:new SVG.Number(p.width).divide(2),ry:new SVG.Number(p.height).divide(2)})}},construct:{circle:function(size){return this.ellipse(size,size)},ellipse:function(width,height){return this.put(new SVG.Ellipse).size(width,height).move(0,0)}}});SVG.Line=SVG.invent({create:"line",inherit:SVG.Shape,extend:{x:function(x){var b=this.bbox();return x==null?b.x:this.attr({x1:this.attr("x1")-b.x+x,x2:this.attr("x2")-b.x+x})},y:function(y){var b=this.bbox();return y==null?b.y:this.attr({y1:this.attr("y1")-b.y+y,y2:this.attr("y2")-b.y+y})},cx:function(x){var half=this.bbox().width/2;return x==null?this.x()+half:this.x(x-half)},cy:function(y){var half=this.bbox().height/2;return y==null?this.y()+half:this.y(y-half)},width:function(width){var b=this.bbox();return width==null?b.width:this.attr(this.attr("x1")<this.attr("x2")?"x2":"x1",b.x+width)},height:function(height){var b=this.bbox();return height==null?b.height:this.attr(this.attr("y1")<this.attr("y2")?"y2":"y1",b.y+height)},size:function(width,height){var p=proportionalSize(this.bbox(),width,height);return this.width(p.width).height(p.height);
},plot:function(x1,y1,x2,y2){return this.attr({x1:x1,y1:y1,x2:x2,y2:y2})}},construct:{line:function(x1,y1,x2,y2){return this.put((new SVG.Line).plot(x1,y1,x2,y2))}}});SVG.Polyline=SVG.invent({create:"polyline",inherit:SVG.Shape,construct:{polyline:function(p){return this.put(new SVG.Polyline).plot(p)}}});SVG.Polygon=SVG.invent({create:"polygon",inherit:SVG.Shape,construct:{polygon:function(p){return this.put(new SVG.Polygon).plot(p)}}});SVG.extend(SVG.Polyline,SVG.Polygon,{morphArray:SVG.PointArray,plot:function(p){return this.attr("points",this.array=new SVG.PointArray(p,[[0,0]]))},move:function(x,y){return this.attr("points",this.array.move(x,y))},x:function(x){return x==null?this.bbox().x:this.move(x,this.bbox().y)},y:function(y){return y==null?this.bbox().y:this.move(this.bbox().x,y)},width:function(width){var b=this.bbox();return width==null?b.width:this.size(width,b.height)},height:function(height){var b=this.bbox();return height==null?b.height:this.size(b.width,height)},size:function(width,height){var p=proportionalSize(this.bbox(),width,height);return this.attr("points",this.array.size(p.width,p.height))}});SVG.Path=SVG.invent({create:"path",inherit:SVG.Shape,extend:{plot:function(p){return this.attr("d",this.array=new SVG.PathArray(p,[["M",0,0]]))},move:function(x,y){return this.attr("d",this.array.move(x,y))},x:function(x){return x==null?this.bbox().x:this.move(x,this.bbox().y)},y:function(y){return y==null?this.bbox().y:this.move(this.bbox().x,y)},size:function(width,height){var p=proportionalSize(this.bbox(),width,height);return this.attr("d",this.array.size(p.width,p.height))},width:function(width){return width==null?this.bbox().width:this.size(width,this.bbox().height)},height:function(height){return height==null?this.bbox().height:this.size(this.bbox().width,height)}},construct:{path:function(d){return this.put(new SVG.Path).plot(d)}}});SVG.Image=SVG.invent({create:"image",inherit:SVG.Shape,extend:{load:function(url){if(!url)return this;var self=this,img=document.createElement("img");img.onload=function(){var p=self.doc(SVG.Pattern);if(self.width()==0&&self.height()==0)self.size(img.width,img.height);if(p&&p.width()==0&&p.height()==0)p.size(self.width(),self.height());if(typeof self._loaded==="function")self._loaded.call(self,{width:img.width,height:img.height,ratio:img.width/img.height,url:url})};return this.attr("href",img.src=this.src=url,SVG.xlink)},loaded:function(loaded){this._loaded=loaded;return this}},construct:{image:function(source,width,height){return this.put(new SVG.Image).load(source).size(width||0,height||width||0)}}});SVG.Text=SVG.invent({create:function(){this.constructor.call(this,SVG.create("text"));this._leading=new SVG.Number(1.3);this._rebuild=true;this._build=false;this.attr("font-family",SVG.defaults.attrs["font-family"])},inherit:SVG.Shape,extend:{x:function(x){if(x==null)return this.attr("x");if(!this.textPath)this.lines.each(function(){if(this.newLined)this.x(x)});return this.attr("x",x)},y:function(y){var oy=this.attr("y"),o=typeof oy==="number"?oy-this.bbox().y:0;if(y==null)return typeof oy==="number"?oy-o:oy;return this.attr("y",typeof y==="number"?y+o:y)},cx:function(x){return x==null?this.bbox().cx:this.x(x-this.bbox().width/2)},cy:function(y){return y==null?this.bbox().cy:this.y(y-this.bbox().height/2)},text:function(text){if(typeof text==="undefined")return this.content;this.clear().build(true);if(typeof text==="function"){text.call(this,this)}else{text=(this.content=text).split("\n");for(var i=0,il=text.length;i<il;i++)this.tspan(text[i]).newLine()}return this.build(false).rebuild()},size:function(size){return this.attr("font-size",size).rebuild()},leading:function(value){if(value==null)return this._leading;this._leading=new SVG.Number(value);return this.rebuild()},rebuild:function(rebuild){if(typeof rebuild=="boolean")this._rebuild=rebuild;if(this._rebuild){var self=this;this.lines.each(function(){if(this.newLined){if(!this.textPath)this.attr("x",self.attr("x"));this.attr("dy",self._leading*new SVG.Number(self.attr("font-size")))}});this.fire("rebuild")}return this},build:function(build){this._build=!!build;return this}},construct:{text:function(text){return this.put(new SVG.Text).text(text)},plain:function(text){return this.put(new SVG.Text).plain(text)}}});SVG.TSpan=SVG.invent({create:"tspan",inherit:SVG.Shape,extend:{text:function(text){typeof text==="function"?text.call(this,this):this.plain(text);return this},dx:function(dx){return this.attr("dx",dx)},dy:function(dy){return this.attr("dy",dy)},newLine:function(){var t=this.doc(SVG.Text);this.newLined=true;return this.dy(t._leading*t.attr("font-size")).attr("x",t.x())}}});SVG.extend(SVG.Text,SVG.TSpan,{plain:function(text){if(this._build===false)this.clear();this.node.appendChild(document.createTextNode(this.content=text));return this},tspan:function(text){var node=(this.textPath||this).node,tspan=new SVG.TSpan;if(this._build===false)this.clear();node.appendChild(tspan.node);tspan.parent=this;if(this instanceof SVG.Text)this.lines.add(tspan);return tspan.text(text)},clear:function(){var node=(this.textPath||this).node;while(node.hasChildNodes())node.removeChild(node.lastChild);if(this instanceof SVG.Text){delete this.lines;this.lines=new SVG.Set;this.content=""}return this},length:function(){return this.node.getComputedTextLength()}});SVG.TextPath=SVG.invent({create:"textPath",inherit:SVG.Element,parent:SVG.Text,construct:{path:function(d){this.textPath=new SVG.TextPath;while(this.node.hasChildNodes())this.textPath.node.appendChild(this.node.firstChild);this.node.appendChild(this.textPath.node);this.track=this.doc().defs().path(d);this.textPath.parent=this;this.textPath.attr("href","#"+this.track,SVG.xlink);return this},plot:function(d){if(this.track)this.track.plot(d);return this}}});SVG.Nested=SVG.invent({create:function(){this.constructor.call(this,SVG.create("svg"));this.style("overflow","visible")},inherit:SVG.Container,construct:{nested:function(){return this.put(new SVG.Nested)}}});SVG.A=SVG.invent({create:"a",inherit:SVG.Container,extend:{to:function(url){return this.attr("href",url,SVG.xlink)},show:function(target){return this.attr("show",target,SVG.xlink)},target:function(target){return this.attr("target",target)}},construct:{link:function(url){return this.put(new SVG.A).to(url)}}});SVG.extend(SVG.Element,{linkTo:function(url){var link=new SVG.A;if(typeof url=="function")url.call(link,link);else link.to(url);return this.parent.put(link).put(this)}});SVG.Marker=SVG.invent({create:"marker",inherit:SVG.Container,extend:{width:function(width){return this.attr("markerWidth",width)},height:function(height){return this.attr("markerHeight",height)},ref:function(x,y){return this.attr("refX",x).attr("refY",y)},update:function(block){this.clear();if(typeof block=="function")block.call(this,this);return this},toString:function(){return"url(#"+this.id()+")"}},construct:{marker:function(width,height,block){return this.defs().marker(width,height,block)}}});SVG.extend(SVG.Defs,{marker:function(width,height,block){return this.put(new SVG.Marker).size(width,height).ref(width/2,height/2).viewbox(0,0,width,height).attr("orient","auto").update(block)}});SVG.extend(SVG.Line,SVG.Polyline,SVG.Polygon,SVG.Path,{marker:function(marker,width,height,block){var attr=["marker"];if(marker!="all")attr.push(marker);attr=attr.join("-");marker=arguments[1]instanceof SVG.Marker?arguments[1]:this.doc().marker(width,height,block);return this.attr(attr,marker)}});var sugar={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(t,a){return a=="color"?t:t+"-"+a}};["fill","stroke"].forEach(function(m){var i,extension={};extension[m]=function(o){if(typeof o=="string"||SVG.Color.isRgb(o)||o&&typeof o.fill==="function")this.attr(m,o);else for(i=sugar[m].length-1;i>=0;i--)if(o[sugar[m][i]]!=null)this.attr(sugar.prefix(m,sugar[m][i]),o[sugar[m][i]]);return this};SVG.extend(SVG.Element,SVG.FX,extension)});SVG.extend(SVG.Element,SVG.FX,{rotate:function(deg,x,y){return this.transform({rotation:deg||0,cx:x,cy:y})},skew:function(x,y){return this.transform({skewX:x||0,skewY:y||0})},scale:function(x,y){return this.transform({scaleX:x,scaleY:y==null?x:y})},translate:function(x,y){return this.transform({x:x,y:y})},matrix:function(m){return this.transform({matrix:m})},opacity:function(value){return this.attr("opacity",value)}});SVG.extend(SVG.Rect,SVG.Ellipse,SVG.FX,{radius:function(x,y){return this.attr({rx:x,ry:y||x})}});SVG.extend(SVG.Path,{length:function(){return this.node.getTotalLength()},pointAt:function(length){return this.node.getPointAtLength(length)}});SVG.extend(SVG.Parent,SVG.Text,SVG.FX,{font:function(o){for(var k in o)k=="leading"?this.leading(o[k]):k=="anchor"?this.attr("text-anchor",o[k]):k=="size"||k=="family"||k=="weight"||k=="stretch"||k=="variant"||k=="style"?this.attr("font-"+k,o[k]):this.attr(k,o[k]);return this}});SVG.Set=SVG.invent({create:function(){this.clear()},extend:{add:function(){var i,il,elements=[].slice.call(arguments);for(i=0,il=elements.length;i<il;i++)this.members.push(elements[i]);return this},remove:function(element){var i=this.index(element);if(i>-1)this.members.splice(i,1);return this},each:function(block){for(var i=0,il=this.members.length;i<il;i++)block.apply(this.members[i],[i,this.members]);return this},clear:function(){this.members=[];return this},has:function(element){return this.index(element)>=0},index:function(element){return this.members.indexOf(element)},get:function(i){return this.members[i]},first:function(){return this.get(0)},last:function(){return this.get(this.members.length-1)},valueOf:function(){return this.members},bbox:function(){var box=new SVG.BBox;if(this.members.length==0)return box;var rbox=this.members[0].rbox();box.x=rbox.x;box.y=rbox.y;box.width=rbox.width;box.height=rbox.height;this.each(function(){box=box.merge(this.rbox())});return box}},construct:{set:function(){return new SVG.Set}}});SVG.SetFX=SVG.invent({create:function(set){this.set=set}});SVG.Set.inherit=function(){var m,methods=[];for(var m in SVG.Shape.prototype)if(typeof SVG.Shape.prototype[m]=="function"&&typeof SVG.Set.prototype[m]!="function")methods.push(m);methods.forEach(function(method){SVG.Set.prototype[method]=function(){for(var i=0,il=this.members.length;i<il;i++)if(this.members[i]&&typeof this.members[i][method]=="function")this.members[i][method].apply(this.members[i],arguments);return method=="animate"?this.fx||(this.fx=new SVG.SetFX(this)):this}});methods=[];for(var m in SVG.FX.prototype)if(typeof SVG.FX.prototype[m]=="function"&&typeof SVG.SetFX.prototype[m]!="function")methods.push(m);methods.forEach(function(method){SVG.SetFX.prototype[method]=function(){for(var i=0,il=this.set.members.length;i<il;i++)this.set.members[i].fx[method].apply(this.set.members[i].fx,arguments);return this}})};SVG.extend(SVG.Element,{data:function(a,v,r){if(typeof a=="object"){for(v in a)this.data(v,a[v])}else if(arguments.length<2){try{return JSON.parse(this.attr("data-"+a))}catch(e){return this.attr("data-"+a)}}else{this.attr("data-"+a,v===null?null:r===true||typeof v==="string"||typeof v==="number"?v:JSON.stringify(v))}return this}});SVG.extend(SVG.Element,{remember:function(k,v){if(typeof arguments[0]=="object")for(var v in k)this.remember(v,k[v]);else if(arguments.length==1)return this.memory()[k];else this.memory()[k]=v;return this},forget:function(){if(arguments.length==0)this._memory={};else for(var i=arguments.length-1;i>=0;i--)delete this.memory()[arguments[i]];return this},memory:function(){return this._memory||(this._memory={})}});function camelCase(s){return s.toLowerCase().replace(/-(.)/g,function(m,g){return g.toUpperCase()})}function fullHex(hex){return hex.length==4?["#",hex.substring(1,2),hex.substring(1,2),hex.substring(2,3),hex.substring(2,3),hex.substring(3,4),hex.substring(3,4)].join(""):hex}function compToHex(comp){var hex=comp.toString(16);return hex.length==1?"0"+hex:hex}function proportionalSize(box,width,height){if(width==null||height==null){if(height==null)height=box.height/box.width*width;else if(width==null)width=box.width/box.height*height}return{width:width,height:height}}function at(o,pos){return typeof o.from=="number"?o.from+(o.to-o.from)*pos:o instanceof SVG.Color||o instanceof SVG.Number?o.at(pos):pos<1?o.from:o.to}function arrayToString(a){for(var i=0,il=a.length,s="";i<il;i++){s+=a[i][0];if(a[i][1]!=null){s+=a[i][1];if(a[i][2]!=null){s+=" ";s+=a[i][2];if(a[i][3]!=null){s+=" ";s+=a[i][3];s+=" ";s+=a[i][4];if(a[i][5]!=null){s+=" ";s+=a[i][5];s+=" ";s+=a[i][6];if(a[i][7]!=null){s+=" ";s+=a[i][7]}}}}}}return s+" "}function boxProperties(b){b.x2=b.x+b.width;b.y2=b.y+b.height;b.cx=b.x+b.width/2;b.cy=b.y+b.height/2}function parseMatrix(o){if(o.matrix){var m=o.matrix.replace(/\s/g,"").split(",");if(m.length==6){o.a=parseFloat(m[0]);o.b=parseFloat(m[1]);o.c=parseFloat(m[2]);o.d=parseFloat(m[3]);o.e=parseFloat(m[4]);o.f=parseFloat(m[5])}}return o}function idFromReference(url){var m=url.toString().match(SVG.regex.reference);if(m)return m[1]}return SVG});(function(){var a=Function.prototype.call.bind(Array.prototype.slice);SVG.extend(SVG.Path,{M:function(b){return b=1===arguments.length?[b.x,b.y]:a(arguments),this.addSegment("M",b,this._redrawEnabled),1===this._segments.length?this.plot("M"+b[0]+" "+b[1]):this},m:function(b){return b=1===arguments.length?[b.x,b.y]:a(arguments),this.addSegment("m",b,this._redrawEnabled),1===this._segments.length?this.plot("m"+b[0]+" "+b[1]):this},L:function(b){return b=1===arguments.length?[b.x,b.y]:a(arguments),this.addSegment("L",b,this._redrawEnabled)},l:function(b){return b=1===arguments.length?[b.x,b.y]:a(arguments),this.addSegment("l",b,this._redrawEnabled)},H:function(a){return this.addSegment("H",[a],this._redrawEnabled)},h:function(a){return this.addSegment("h",[a],this._redrawEnabled)},V:function(a){return this.addSegment("V",[a],this._redrawEnabled)},v:function(a){return this.addSegment("v",[a],this._redrawEnabled)},C:function(b,c,d){return d=3===arguments.length?[b.x,b.y,c.x,c.y,d.x,d.y]:a(arguments),this.addSegment("C",d,this._redrawEnabled)},c:function(b,c,d){return d=3===arguments.length?[b.x,b.y,c.x,c.y,d.x,d.y]:a(arguments),this.addSegment("c",d,this._redrawEnabled)},S:function(b,c){return c=2===arguments.length?[b.x,b.y,c.x,c.y]:a(arguments),this.addSegment("S",c,this._redrawEnabled)},s:function(b,c){return c=2===arguments.length?[b.x,b.y,c.x,c.y]:a(arguments),this.addSegment("s",c,this._redrawEnabled)},Q:function(b,c){return c=2===arguments.length?[b.x,b.y,c.x,c.y]:a(arguments),this.addSegment("Q",c,this._redrawEnabled)},q:function(b,c){return c=2===arguments.length?[b.x,b.y,c.x,c.y]:a(arguments),this.addSegment("q",c,this._redrawEnabled)},T:function(b){return b=1===arguments.length?[b.x,b.y]:a(arguments),this.addSegment("T",b,this._redrawEnabled)},t:function(b){return b=1===arguments.length?[b.x,b.y]:a(arguments),this.addSegment("t",b,this._redrawEnabled)},A:function(b,c,d,e,f,g){return g=6===arguments.length?[b,c,d,e,f,g.x,g.y]:a(arguments),this.addSegment("A",g,this._redrawEnabled)},a:function(b,c,d,e,f,g){return g=6===arguments.length?[b,c,d,e,f,g.x,g.y]:a(arguments),this.addSegment("a",g,this._redrawEnabled)},Z:function(){return this.addSegment("Z",[],this._redrawEnabled)},addSegment:function(a,b,c){var d={type:a,coords:b};return this._segments||(this._segments=[]),this._segments.push(d),c!==!1&&this._drawSegment(d),this},clear:function(){return this._segments&&(this._segments.length=0),this._lastSegment=null,this.plot()},getSegmentCount:function(){return this._segments.length},getSegment:function(a){return this._segments[a]},removeSegment:function(a){return this._segments.splice(a,1),this.redraw()},replaceSegment:function(a,b){return this._segments.splice(a,1,b),this.redraw()},drawAnimated:function(a){a=a||{},a.duration=a.duration||"1000",a.easing=a.easing||"<>",a.delay=a.delay||0;var b=this.length();this.stroke({width:2,dasharray:b+" "+b,dashoffset:b});var c=this.animate(a.duration,a.easing,a.delay);return c.stroke({dashoffset:0}),this},update:function(a){return a===!0&&(this._redrawEnabled=!1),a===!1&&(this._redrawEnabled=!0),!!this._redrawEnabled},redraw:function(){return this._lastSegment=null,this.attr("d",""),this._drawSegment(this._segments)},_drawSegment:function(a){var b="",c=this._lastSegment;Array.isArray(a)||(a=[a]);for(var d=0;d<a.length;d+=1)b+=c===a[d].type?" "+a[d].coords.join(" "):" "+a[d].type+a[d].coords.join(" "),c=a[d].type;return this._lastSegment=c,this.attr("d",(this.attr("d")||"")+b)}})}).call(this);SVG.ForiegnObject=function(){this.constructor.call(this,SVG.create("foreignObject"));this.type="foreignObject"};SVG.ForiegnObject.prototype=new SVG.Shape;SVG.extend(SVG.ForiegnObject,{appendChild:function(child,attrs){var newChild=typeof child=="string"?document.createElement(child):child;if(typeof attrs=="object"){for(a in attrs)newChild[a]=attrs[a]}this.node.appendChild(newChild);return this},getChild:function(index){return this.node.childNodes[index]}});SVG.extend(SVG.Container,{foreignObject:function(width,height){return this.put(new SVG.ForiegnObject).size(width==null?100:width,height==null?100:height)}});(function(){SVG.extend(SVG.Element,{draggable:function(context,constraint,attachToEls){var startDrag,drag,endDrag,element=this,parent=this._parent(SVG.Doc)||this.parent._parent(SVG.Nested);if(!attachToEls){attachToEls=[element]}if(typeof this.fixedDrag==="function")this.fixedDrag();constraint=constraint||{};startDrag=function(event){event=event||window.event;element.startEventDrag=event;if(context.dragstart)context.dragstart(event);event.preventDefault?event.preventDefault():event.returnValue=false;event.stopPropagation()};drag=function(event){event=event||window.event;if(element.startEventDrag){var rotation=context.absoluteRotation*Math.PI/180;var bbox={x:element.x(),y:element.y()};var zoom=context.workspace.absoluteScale*context.workspace.scale;var ddx=(event.ddx*Math.cos(rotation)+event.ddy*Math.sin(rotation))/zoom;var ddy=(event.ddy*Math.cos(rotation)+event.ddx*Math.sin(-rotation))/zoom;x=bbox.x+ddx;y=bbox.y+ddy;if(typeof constraint==="function"){var coord=constraint(x,y);if(typeof coord==="object"){if(typeof coord.x!="boolean"||coord.x)element.x(typeof coord.x==="number"?coord.x:x);if(typeof coord.y!="boolean"||coord.y)element.y(typeof coord.y==="number"?coord.y:y)}else if(typeof coord==="boolean"&&coord){element.move(x,y);context.x=x;context.y=y}}else if(typeof constraint==="object"){if(constraint.minX!=null&&x<constraint.minX)x=constraint.minX;else if(constraint.maxX!=null&&x>constraint.maxX-width)x=constraint.maxX-width;if(constraint.minY!=null&&y<constraint.minY)y=constraint.minY;else if(constraint.maxY!=null&&y>constraint.maxY-height)y=constraint.maxY-height;element.move(x,y);context.x=x;context.y=y}if(context.dragmove)context.dragmove(event)}event.stopPropagation()};endDrag=function(event){event=event||window.event;element.startEventDrag=null;element.startPositionDrag=null;if(context.dragend)context.dragend(event);event.stopPropagation()};attachToEls.forEach(function(el){PolymerGestures.addEventListener(el.node,"trackstart",startDrag);PolymerGestures.addEventListener(el.node,"track",drag);PolymerGestures.addEventListener(el.node,"trackend",endDrag);PolymerGestures.addEventListener(el.node,"down",function(e){e.preventDefault()})});element.fixedDrag=function(){attachToEls.forEach(function(el){PolymerGestures.removeEventListener(el.node,"trackstart",startDrag);PolymerGestures.removeEventListener(el.node,"track",drag);PolymerGestures.removeEventListener(el.node,"trackend",endDrag)});startDrag=drag=endDrag=null;return element};return this}})}).call(this);(function(){SVG.extend(SVG.Element,{pannable:function(context,constraint,attachToEls,pannableEls){var startPan,pan,endPan,element=this,parent=this._parent(SVG.Doc)||this.parent._parent(SVG.Nested);if(!attachToEls){attachToEls=[element]}if(typeof this.fixedPan==="function")this.fixedPan();constraint=constraint||{};startPan=function(event){event=event||window.event;element.startEventPan=event;if(context.panstart)context.panstart({zoom:element.startPositionsPan},event);event.preventDefault?event.preventDefault():event.returnValue=false;event.stopPropagation()};pan=function(event){event=event||window.event;if(element.startEventPan){for(var i=0;i<pannableEls.length;i++){var child=pannableEls[i];var rotation=context.absoluteRotation*Math.PI/180;var bbox={x:child.x(),y:child.y()};var ddx=(event.ddx*Math.cos(rotation)+event.ddy*Math.sin(rotation))/context.absoluteScale;var ddy=(event.ddy*Math.cos(rotation)+event.ddx*Math.sin(-rotation))/context.absoluteScale;x=bbox.x+ddx;y=bbox.y+ddy;if(typeof constraint==="function"){var coord=constraint(x,y);if(typeof coord==="object"){if(typeof coord.x!="boolean"||coord.x)child.x(typeof coord.x==="number"?coord.x:x);if(typeof coord.y!="boolean"||coord.y)child.y(typeof coord.y==="number"?coord.y:y)}else if(typeof coord==="boolean"&&coord){child.move(x,y)}}else if(typeof constraint==="object"){if(constraint.minX!=null&&x<constraint.minX)x=constraint.minX;else if(constraint.maxX!=null&&x>constraint.maxX-width)x=constraint.maxX-width;if(constraint.minY!=null&&y<constraint.minY)y=constraint.minY;else if(constraint.maxY!=null&&y>constraint.maxY-height)y=constraint.maxY-height;child.move(x,y)}if(context.panmove)context.panmove(delta,event)}}event.stopPropagation()};endPan=function(event){event=event||window.event;var delta={x:event.pageX-element.startEventPan.pageX,y:event.pageY-element.startEventPan.pageY,zoom:parent.viewbox().zoom};element.startEventPan=null;element.startPositionsPan=null;if(context.panend)context.panend(delta,event);event.stopPropagation()};attachToEls.forEach(function(el){PolymerGestures.addEventListener(el.node,"trackstart",startPan);PolymerGestures.addEventListener(el.node,"track",pan);PolymerGestures.addEventListener(el.node,"trackend",endPan);PolymerGestures.addEventListener(el.node,"down",function(e){e.preventDefault()})});element.fixedPan=function(){attachToEls.forEach(function(el){PolymerGestures.removeEventListener(el.node,"trackstart",startPan);PolymerGestures.removeEventListener(el.node,"track",pan);PolymerGestures.removeEventListener(el.node,"trackend",endPan)});startPan=pan=endPan=null;return element};return this}})}).call(this);(function(){SVG.extend(SVG.Element,{resizable:function(context,constraint,attachToEls){var startResize,resize,endResize,initialWidth,initialHeight,element=this,parent=this._parent(SVG.Doc)||this.parent._parent(SVG.Nested);if(!attachToEls){attachToEls=[element]}if(typeof this.fixedResize==="function")this.fixedResize();constraint=constraint||{};startResize=function(event){event=event||window.event;initialWidth=context.width;initialHeight=context.height;element.startEventResize=event;if(context.resizestart)context.resizestart(event);event.preventDefault?event.preventDefault():event.returnValue=false;event.stopPropagation()};resize=function(event){event=event||window.event;if(element.startEventResize){var rotation=context.absoluteRotation*Math.PI/180;var zoom=context.workspace.absoluteScale*context.workspace.scale;var ddx=(event.ddx*Math.cos(rotation)+event.ddy*Math.sin(rotation))/zoom;var ddy=(event.ddy*Math.cos(rotation)+event.ddx*Math.sin(-rotation))/zoom;var dx=(event.dx*Math.cos(rotation)+event.dy*Math.sin(rotation))/zoom;var dy=(event.dy*Math.cos(rotation)+event.dx*Math.sin(-rotation))/zoom;if(initialWidth+dx>=0){context.setWidth(initialWidth+dx)}if(initialHeight+dy>=0){context.setHeight(initialHeight+dy)}if(context.resizemove)context.resizemove(event)}event.stopPropagation()};endResize=function(event){event=event||window.event;element.startEventResize=null;context;if(context.resizeend)context.resizeend(event);event.stopPropagation()};attachToEls.forEach(function(el){PolymerGestures.addEventListener(el.node,"trackstart",startResize);PolymerGestures.addEventListener(el.node,"track",resize);PolymerGestures.addEventListener(el.node,"trackend",endResize);PolymerGestures.addEventListener(el.node,"down",function(e){e.preventDefault()})});element.fixedResize=function(){attachToEls.forEach(function(el){PolymerGestures.removeEventListener(el.node,"trackstart",startResize);PolymerGestures.removeEventListener(el.node,"track",resize);PolymerGestures.removeEventListener(el.node,"trackend",endResize)});startResize=resize=endResize=null;return element};return this}})}).call(this);(function(){SVG.extend(SVG.Element,{scalable:function(context,constraint,attachToEls){var mouseWheelScale,mouseMoveTracking,pinch,pinchEnd,element=this,constraint,parent=this._parent(SVG.Doc)||this.parent._parent(SVG.Nested);if(!attachToEls){attachToEls=[element]}if(typeof this.fixedScale==="function")this.fixedScale();constraint=constraint||{};mouseMoveTracking=function(e){context.mousePosition=mouseToSvg(e,context.root.node)};mouseWheelScale=function(e){var e=window.event||e;var delta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));var x=context.mousePosition.x;var y=context.mousePosition.y;if(context.scalestart)context.scalestart(x,y,delta);context.zoom(x,y,delta);e.preventDefault()};pinchStart=function(e){if(context.scalestart)context.scalestart(e);element.pinchdScale=element.pinchScale;element.pinchScale=e.scale;var evtPos={clientX:e.centerX,clientY:e.centerY};element.pinchCenter=mouseToSvg(evtPos,context.root.node);e.preventDefault()};pinch=function(e){element.pinchdScale=e.scale/element.pinchScale;element.pinchScale=e.scale;context.zoom(element.pinchCenter.x,element.pinchCenter.y,null,element.pinchdScale);e.preventDefault()};pinchEnd=function(e){dScale=1;element.pinchScale=null;e.preventDefault()};attachToEls.forEach(function(el){el.node.addEventListener("mousemove",mouseMoveTracking);el.node.addEventListener("DOMMouseScroll",mouseWheelScale);el.node.addEventListener("mousewheel",mouseWheelScale);PolymerGestures.addEventListener(el.node,"pinchstart",pinchStart);PolymerGestures.addEventListener(el.node,"pinch",pinch);PolymerGestures.addEventListener(el.node,"pinchend",pinchEnd)});element.fixedScale=function(){attachToEls.forEach(function(el){el.node.removeEventListener("mousemove",mouseMoveTracking);el.node.removeEventListener("DOMMouseScroll",mouseWheelScale);el.node.removeEventListener("mousewheel",mouseWheelScale);PolymerGestures.removeEventListener(el.node,"pinchstart",pinchStart);PolymerGestures.removeEventListener(el.node,"pinch",pinch);PolymerGestures.removeEventListener(el.node,"pinchend",pinchEnd)});pinch=pinchEnd=mouseWheelScale=mouseMoveTracking=null;return element};return this}})}).call(this);"use strict";var ObjJS=function(){this.parentClass_=Object.create(null)};ObjJS.prototype.create=function(classPrototype){if(!classPrototype){throw"Must have a block protoype as argument";return}if(!classPrototype.constructor){classPrototype.constructor=function(){}}var createdClass=function(){classPrototype.constructor.apply(this,arguments);delete this.create};createdClass.prototype=ObjJS.cloneObject(this);ObjJS.mixin(createdClass,classPrototype,"true");createdClass.prototype.create=ObjJS.prototype.create;createdClass.prototype.parentClass_=this;return createdClass};ObjJS.cloneObject=function(obj){var type=typeof obj;if(obj==null){return null}if(type=="object"||type=="array"){if(obj.clone){return obj.clone()}var clone=type=="array"?[]:{};for(var key in obj){clone[key]=ObjJS.cloneObject(obj[key])}return clone}return obj};ObjJS.mixin=function(receivingClass,givingMixin,override){if(override==undefined){override=false}if(arguments[3]){for(var i=3,len=arguments.length;i<len;i++){if(!Object.hasOwnProperty.call(receivingClass.prototype,arguments[i])||override){receivingClass.prototype[arguments[i]]=ObjJS.cloneObject(givingMixin[arguments[i]])}}}else{for(var methodName in givingMixin){if(!Object.hasOwnProperty.call(receivingClass.prototype,methodName)||override){receivingClass.prototype[methodName]=ObjJS.cloneObject(givingMixin[methodName])}}}};ObjJS.mixinObj=function(receivingObj,givingMixin,override){if(override==undefined){override=false}if(arguments[3]){for(var i=3,len=arguments.length;i<len;i++){if(!Object.hasOwnProperty.call(receivingObj,arguments[i])||override){receivingObj[arguments[i]]=ObjJS.cloneObject(givingMixin[arguments[i]])}}}else{for(var methodName in givingMixin){if(!Object.hasOwnProperty.call(receivingObj,methodName)||override){receivingObj[methodName]=ObjJS.cloneObject(givingMixin[methodName])}}}};function convertCoordinates(x,y,toSvg,node){if(toSvg){x-=window.scrollX||window.pageXOffset;y-=window.scrollY||window.pageYOffset}var svgPoint=node.createSVGPoint();svgPoint.x=x;svgPoint.y=y;var matrix=node.getScreenCTM();if(toSvg){matrix=matrix.inverse()}var xy=svgPoint.matrixTransform(matrix);if(!toSvg){xy.x+=window.scrollX||window.pageXOffset;xy.y+=window.scrollY||window.pageYOffset}return xy}function mouseToSvg(e,node){var scrollX=window.scrollX||window.pageXOffset;var scrollY=window.scrollY||window.pageYOffset;return convertCoordinates(e.clientX+scrollX,e.clientY+scrollY,true,node)}function setCaretPosition(el,position){el.selectionStart=position;el.selectionEnd=position;el.focus()}function color2negative(hex){hex=String(hex).replace(/[^0-9a-f]/gi,"");if(hex.length<6){hex=hex.replace(/(.)/g,"$1$1")}var rgb="#",c;for(var i=0;i<3;++i){c=parseInt(hex.substr(i*2,2),16);c=(255-c).toString(16);rgb+=("00"+c).substr(c.length)}return rgb}"use strict";var BB={};BB.Component=ObjJS.prototype.create({constructor:function(type){this.type=type;this.children=[];this.nested=false;this.level=0;this.absoluteRotation=0;this.rotation=0;this.offsetX=0;this.offsetY=0;this.offsetX2=0;this.offsetY2=0;this.rendered_=false;this.initialized_=false;this.selectable=false;this.selected_=false;this.preserveChildsOnUnselect=false;this.selectedClass=""},setSelected:function(bool){if(this.selectable&&this.selected_!=bool){this.selected_=bool;if(this.selected_){this.root.addClass(this.selectedClass);this.toTop();if(this.onSelect){this.onSelect()}}else{this.root.removeClass(this.selectedClass);if(this.onBlur){this.onBlur()}if(!this.preserveChildsOnUnselect){this.unselectChilds()}}if(this.onSelectedChange){this.onSelectedChange()}if(this.parent){if(this.selected_&&this.parent.childSelected){this.parent.childSelected(this)}if(!this.selected_&&this.parent.childUnselected){this.parent.childUnselected(this)}}}},childSelected:function(child){this.setSelected(true);var i,len=this.children.length;for(i=0;i<len;i++){if(this.children[i]!=child&&this.children[i].setSelected){this.children[i].setSelected(false)}}},unselectChilds:function(){var i,len=this.children.length;for(i=0;i<len;i++){if(this.children[i].setSelected){this.children[i].setSelected(false)}}},addWorkspace:function(name,workspacePrototype,options){return this.addWorkspace_(new BB.Workspace(name,workspacePrototype,this,options))},addWorkspace_:function(workspace){if(this.type=="Block"){throw"Blocks can't have Workspaces attached";return}this.children.push(workspace);this.children[this.children.length-1].level=this.level+1;this.children[this.children.length-1].parent=this;if(this.childAdded){this.childAdded(this.children[this.children.length-1])}return this.children[this.children.length-1]},addBlock:function(name,blockPrototype,options){var block=this.createBlock(name,blockPrototype);return this.addBlock_(new block(options))},addBlock_:function(block){if(block.type!="Block"){throw"The type of object must be Block";return}this.children.push(block);block.workspace=this;block.parent=this;block.absoluteRotation=block.absoluteRotation+this.absoluteRotation;if(this.childAdded){this.childAdded(this.children[this.children.length-1])}return this.children[this.children.length-1]},createBlock:function(name,blockPrototype){if(!blockPrototype){throw"Must have a block protoype as argument";return}if(!blockPrototype.init){throw"Block protoype must have a init function";return}blockPrototype.constructor=function(options){BB.Block.call(this,name,options)};var block=BB.Block.prototype.create(blockPrototype);
return block},toTop:function(){if(this.nested){this.workspace.childContainer.node.appendChild(this.container.node)}},toTopPropagate:function(){var obj=this;if(this.nested){this.workspace.childContainer.node.appendChild(this.container.node);while(obj.workspace.nested){obj=obj.workspace;obj.workspace.childContainer.node.appendChild(obj.container.node)}}},rotate:function(rotation){if(this.container){var dRotation=rotation-this.rotation;var bbox=this.container.bbox();this.rotation=rotation;this.notifyRotation(dRotation);return this.container.rotate(rotation,bbox.x+this.width/2+this.offsetX,bbox.y+this.height/2+this.offsetY)}},notifyRotation:function(dRotation){this.absoluteRotation+=dRotation;this.children.forEach(function(el){if(el.notifyRotation){el.notifyRotation(dRotation)}})},move:function(x,y){if(this.container){this.x=x;this.y=y;this.container.move(this.x,this.y);return this}else{throw"Main Workspaces don't have container"}},dmove:function(dx,dy){if(this.container){this.x+=dx;this.y+=dy;this.container.dmove(dx,dy);return this}else{throw"Main Workspaces don't have container"}},animate:function(){if(this.container){return this.container.animate.apply(this.container,arguments)}else{throw"Main Workspaces don't have container"}},updateRender:function(){this.unRender();this.render()},unRender:function(){var i,len=this.children.length;for(i=0;i<len;i++){if(this.children[i].unRender){this.children[i].unRender()}}if(this.onUnRender){this.onUnRender()}if(this.container){this.container.remove()}else{this.root.remove()}this.rendered_=false}});BB.attachToEls=function(els,eventName,func){var i;var len=els.length;for(i=0;i<len;i++){PolymerGestures.removeEventListener(els[i].node,eventName,func);PolymerGestures.addEventListener(els[i].node,eventName,func)}};BB.colorPalettes={workspace:{light:{background:{nested:"#EDEEEA",main:"#fff"},border:{nested:"#1B65A6",main:"#ddd"},dragBoxColor:"#369E58",resizeBoxColor:"#F0A509"},dark:{background:{nested:"#F2F2F2",main:"#222222"},border:{nested:"#1ABC9C",main:"#ddd"},dragBoxColor:"#369E58",resizeBoxColor:"#F0A509"}},block:{light:{background:"#1DA53C",border:"#000",shadowColor:"rgba(29, 95, 44, 0.75)",lightColor:"rgb(70, 204, 101)"},dark:{background:"#14925C",border:"#fff",shadowColor:"rgba(20, 146, 92, 0.81)",lightColor:"#25c17e"}}};"use strict";BB.Block=BB.Component.prototype.create({constructor:function(name,options,customOptions){BB.Component.prototype.constructor.call(this,"Block");this.name=name;this.id=null;this.x=0;this.y=0;this.width=20;this.height=20;this.container=null;this.childContainer=null;this.statement=true;this.root=null;this.nested=true;this.fields=[];this.attachDraggable=[];this.style={className:"BBComponentBlock"};this.selectedClass="BBComponentBlockSelected";this.selectable=true;this.draggable_=true;this.disabled_=false;this.metrics={borderRadius:2,borderWidth:1,initialSpace:{x:4,y:4},finalSpace:{x:4,y:4},fieldSpace:5,topRowSpace:1.25,bottomRowSpace:1.25,widthType:"globalWidth"};if(customOptions){this.customOptions=customOptions}if(!options){return}this.optionList=["x","y","stylingFunction","colorPalette","metrics","selectable"];for(var i=0,el;el=this.optionList[i];i++){if(options.hasOwnProperty(el)){this[el]=options[el]}}if(options.hasOwnProperty("draggable")){this.draggable_=options.draggable}if(options.hasOwnProperty("selected")){this.selected_=options.selected}if(options.hasOwnProperty("disabled")){this.disabled_=options.disabled}if(options.render){this.render()}},appendField:function(field){field.index=this.fields.length;this.fields.push(field);return field},newRow:function(){this.fields.push("newRow")},widthType:function(type){if(type=="grouped"){this.fields.push("groupedWidth")}else if(type=="global"){this.fields.push("globalWidth")}else if(type=="single"){this.fields.push("singleWidth")}else{throw"Unknown width type"}},render:function(){if(!this.workspace){throw"Blocks must have a workspace to be rendered";return}if(!this.rendered_){if(!this.colorPalette){this.colorPalette=BB.colorPalettes.block.light}this.bgColor=this.colorPalette.background;this.borderColor=this.colorPalette.border;if(this.stylingFunction){this.stylingFunction()}if(!this.initialized_){this.init(this.customOptions);this.initialized_=true}else{this.root.remove()}this.container=this.workspace.root.group();this.container.move(this.x,this.y);this.initSvg();this.renderBlock_();this.childContainer=this.workspace.root.group();for(var i=0;i<this.children.length;i++){this.children[i].render();this.childContainer.add(this.children[i].container)}this.container.add(this.root);this.container.add(this.childContainer);for(var i=0;i<this.fields.length;i++){if(typeof this.fields[i]=="object"){this.fields[i].toTop()}}this.attachDraggable.push(this.root);this.updateDraggable();this.workspace.childContainer.add(this.container);this.workspace.childRendered(this);if(this.attach){this.attach()}if(this.selected_){this.root.addClass(this.selectedClass)}else{this.root.removeClass(this.selectedClass)}if(this.disabled_){this.root.fill(this.workspace.style.blockDisabledPattern)}else{this.root.fill(this.bgColor)}this.rendered_=true}},attachEvents:function(child){this.attachDraggable.push(child);this.container.draggable(this.workspace,null,this.attachDraggable)},updateDraggable:function(){var this_=this;if(this.toTopClosure==undefined){this.pereventDefaultClosure=function(e){e.preventDefault();e.stopPropagation()}}BB.attachToEls(this.attachDraggable,"down",this.pereventDefaultClosure);if(this.draggable_){this.container.draggable(this,null,this.attachDraggable)}else if(this.rendered_){this.container.fixedDrag()}if(this.toTopClosure==undefined){this.toTopClosure=function(e){this_.setSelected(true);e.preventDefault();e.stopPropagation()}}BB.attachToEls(this.attachDraggable,"down",this.toTopClosure)},dragstart:function(){this.root.addClass("BBComponentBlockDragging")},dragend:function(){this.root.removeClass("BBComponentBlockDragging")},setDraggable:function(bool){this.draggable_=bool;if(this.rendered_){this.updateDraggable()}},initSvg:function(){var globalWidth=this.metrics.initialSpace.x,box,maxHeight=0;var metrics={width:this.metrics.initialSpace.x,y:this.metrics.initialSpace.y};this.metrics.rows=[];this.metrics.numRows=0;var topRowSpace=0;var bottomRowSpace=this.metrics.bottomRowSpace;for(var i=0;i<this.fields.length;i++){if(typeof this.fields[i]=="string"){switch(this.fields[i]){case"newRow":metrics.y+=maxHeight+bottomRowSpace+topRowSpace;metrics.width+=this.metrics.finalSpace.x-this.metrics.fieldSpace;this.metrics.rows[this.metrics.numRows]={width:metrics.width,y:metrics.y,height:maxHeight+bottomRowSpace+topRowSpace,widthType:this.metrics.widthType};this.metrics.numRows++;topRowSpace=this.metrics.topRowSpace;globalWidth=Math.max(metrics.width,globalWidth);metrics.width=this.metrics.initialSpace.x;maxHeight=0;break;case"globalWidth":this.metrics.widthType="globalWidth";break;case"groupedWidth":this.metrics.widthType="groupedWidth";break;case"singleWidth":this.metrics.widthType="singleWidth";break;default:throw"Unknown width type"}}else{this.metrics.rows[this.metrics.numRows]={width:metrics.width,y:metrics.y,height:maxHeight+bottomRowSpace+topRowSpace,widthType:this.metrics.widthType};this.fields[i].row=this.metrics.numRows;if(this.fields[i].rendered_){this.container.add(this.fields[i].container)}else{this.fields[i].render()}box=this.fields[i].bbox();this.fields[i].container.move(metrics.width,metrics.y+bottomRowSpace+topRowSpace);metrics.width+=box.width+this.metrics.fieldSpace;maxHeight=Math.max(maxHeight,box.height+bottomRowSpace+topRowSpace)}}metrics.width+=this.metrics.finalSpace.x-this.metrics.fieldSpace;globalWidth=Math.max(metrics.width,globalWidth);metrics.y+=box.height+bottomRowSpace+topRowSpace+this.metrics.finalSpace.y;this.metrics.rows.push({width:metrics.width,y:metrics.y,height:maxHeight,widthType:this.metrics.widthType});this.width=globalWidth;this.height=metrics.y;var i,j,groupFound=false,maxWidth;for(i=0;i<this.metrics.rows.length;i++){if(this.metrics.rows[i].widthType=="groupedWidth"){if(groupFound==false){maxWidth=this.metrics.rows[i].width;for(j=i+1;j<this.metrics.rows.length&&this.metrics.rows[j].widthType=="groupedWidth";j++){maxWidth=Math.max(maxWidth,this.metrics.rows[j].width)}groupFound=true}this.metrics.rows[i].width=maxWidth}else{if(this.metrics.rows[i].widthType=="globalWidth"){this.metrics.rows[i].width=this.width}groupFound=false}}var height,lastWidth=this.metrics.rows[0].width;this.metrics.rows[0].lastRadius="plane";for(i=1;i<this.metrics.rows.length;i++){height=this.metrics.rows[i].height;if(lastWidth<this.metrics.rows[i].width){this.metrics.rows[i].lastRadius="convex";this.metrics.rows[i-1].nextRadius="concave"}else if(lastWidth>this.metrics.rows[i].width){this.metrics.rows[i].lastRadius="concave";this.metrics.rows[i-1].nextRadius="convex"}else{this.metrics.rows[i].lastRadius="plane";this.metrics.rows[i-1].nextRadius="plane"}lastWidth=this.metrics.rows[i].width}this.metrics.rows[this.metrics.rows.length-1].nextRadius="convex"},renderBlock_:function(){var radius=this.metrics.borderRadius;var rowSpace=this.metrics.rowSpace;if(!this.root){this.root=this.container.path()}else{this.root.clear()}this.root.M({x:radius,y:this.height}).q({x:-radius,y:0},{x:-radius,y:-radius}).v(-this.height+2*radius).q({x:0,y:-radius},{x:radius,y:-radius});var row=this.metrics.rows[0];var height=row.y;height-=radius;this.root.H(row.width-radius).q({x:radius,y:0},{x:radius,y:radius});for(var i=1;i<this.metrics.rows.length;i++){row=this.metrics.rows[i];height=row.y;height-=radius;if(row.lastRadius=="convex"){this.root.q({x:0,y:radius},{x:radius,y:radius}).H(row.width-radius).q({x:radius,y:0},{x:radius,y:radius}).V(height)}else if(row.lastRadius=="concave"){this.root.q({x:0,y:radius},{x:-radius,y:radius}).H(row.width+radius).q({x:-radius,y:0},{x:-radius,y:radius}).V(height)}else if(row.lastRadius=="plane"){this.root.V(height)}else{throw"Unsopported type of radius: "+row.lastRadius}}var finalRow=this.metrics.rows[this.metrics.rows.length-1];var finalWidth=finalRow.width;this.root.q({x:0,y:radius},{x:-radius,y:radius}).h(-finalWidth+2*radius).Z();this.root.fill(this.bgColor);this.root.addClass(this.style.className)},setColor:function(color){this.bgColor=color;if(this.rendered_){this.root.fill(color)}},setDisabled:function(bool){this.disabled_=bool;if(this.rendered_){if(this.disabled_){this.root.fill(this.workspace.style.blockDisabledPattern)}else{this.root.fill(this.bgColor)}}},fieldChanged:function(index){this.initSvg();this.renderBlock_()},onBlur:function(){var i,len=this.fields.length;for(i=0;i<len;i++){if(typeof this.fields[i]=="object"&&this.fields[i].setSelected){this.fields[i].setSelected(false)}}},onUnRender:function(){var i,len=this.fields.length;for(i=0;i<len;i++){if(this.fields[i].unRender){this.fields[i].unRender()}}}});"use strict";BB.Workspace=BB.Component.prototype.create({constructor:function(name,workspacePrototype,workspace,options){BB.Component.prototype.constructor.call(this,"Workspace");this.name=name;this.title="";this.width=200;this.height=200;this.x=0;this.y=0;this.container=null;this.childContainer=null;this.absoluteScale=1;this.scale=1;this.absoluteRotation=0;this.rotation=0;this.border=null;this.background=null;this.dragBox=null;this.resizeBox=null;this.scaleSpeed=1.2;this.minScale=.3;this.maxScale=10;this.offsetX=0;this.offsetY=0;this.offsetX2=0;this.offsetY2=0;this.centerOffsetX=0;this.centerOffsetY=0;this.pannable=true;this.selectable=true;this.attachedElements=[];this.style={className:"BBComponentWorkspace"};if(!workspace){return}this.workspace=workspace;if(workspacePrototype){ObjJS.mixinObj(this,workspacePrototype,"true")}if(!options){return}this.optionList=["x","y","width","height","stylingFunction","colorPalette","metrics","selectable","title","preserveChildsOnSelect"];for(var i=0,el;el=this.optionList[i];i++){if(options[el]){this[el]=options[el]}}if(options.pannable!=undefined){this.pannable=pannable}if(options.render){this.render()}},render:function(){if(!this.workspace){throw"Workspace must have a div identifier or other workspace for be rendered"}if(!this.rendered_){this.nested=!(typeof this.workspace==="string");if(this.nested){this.container=this.workspace.root.group();this.container.move(this.x,this.y);this.root=this.container.nested();this.root.size(this.width,this.height)}else{this.root=SVG(this.workspace).fixSubPixelOffset();this.root.size("100%","100%");this.width="100%";this.height="100%"}this.style.blockDisabledPattern=this.root.pattern(10,10,function(add){add.rect(10,10).fill("#aaa");add.path("M 0 0 L 10 10 M 10 0 L 0 10").stroke("#cc0")});if(!this.colorPalette){this.colorPalette=BB.colorPalettes.workspace.light}this.bgColor=this.colorPalette.background[this.nested?"nested":"main"];this.background=this.root.rect(this.width,this.height).fill(this.bgColor);this.root.attr("style","overflow: hidden;");this.childContainer=this.root.group();for(var i=0;i<this.children.length;i++){if(!this.children[i].rendered&&this.children[i].render){this.children[i].render()}}if(this.nested){this.workspace.childContainer.add(this.container)}this.attachPannable=[this.background];if(this.pannable){this.childContainer.pannable(this,null,this.attachPannable,[this.childContainer])}if(this.init){this.attachedElements=this.init();if(this.workspace){var i,len=this.attachedElements.length;for(i=0;i<len;i++){this.attachedElements[i].scalable(this.workspace,this.attachedElements)}}}if(this.stylingFunction){this.stylingFunction()}var this_=this;BB.attachToEls(this.attachPannable,"down",function(){this_.setSelected(true);this_.unselectChilds()});BB.attachToEls(this.attachedElements,"down",function(){this_.setSelected(true)});this.attachScalable=[this.background];for(var i=0;i<this.children.length;i++){if(this.children[i].type=="Block"){this.attachScalable.push(this.children[i])}}this.childContainer.scalable(this,null,this.attachScalable);this.rendered_=true}return this},childRendered:function(child){if(child.type=="Block"){this.attachScalable.push(child.container);this.childContainer.scalable(this,null,this.attachScalable)}},toScale:function(scale){var fScale=scale/this.scale;this.childContainer.scale(scale);this.scale=scale;this.notifyScaling(fScale)},notifyScaling:function(fScale){this.children.forEach(function(el){if(el.type=="Workspace"){el.absoluteScale*=fScale;el.notifyScaling(fScale)}})},resize:function(width,height){this.width=width;this.height=height;this.root.size(width,height);this.background.size(width,height);if(this.onResize){this.onResize(width,height)}},setWidth:function(width){this.width=width;this.root.width(width);this.background.width(width);if(this.onWidthChanged){this.onWidthChanged(width)}},setHeight:function(height){this.height=height;this.root.height(height);this.background.height(height);if(this.onHeightChanged){this.onHeightChanged(height)}},zoom:function(x,y,type,delta){var speed=this.scaleSpeed,dScale;var center=this.root.node.createSVGPoint();center.x=x;center.y=y;center=center.matrixTransform(this.childContainer.node.getCTM().inverse());var x=center.x;var y=center.y;if(delta){dScale=delta}else{dScale=type==1?speed:1/speed}var matrix=this.childContainer.node.getCTM().translate(-(x*(dScale-1)),-(y*(dScale-1))).scale(dScale);if(matrix.a>=this.minScale&&matrix.a<=this.maxScale){this.toScale(matrix.a);this.childContainer.move(matrix.e,matrix.f)}}});"use strict";BB.Field=BB.Component.prototype.create({constructor:function(type){BB.Component.prototype.constructor.call(this,type);this.rendered_=false;this.index_=null},bbox:function(type){if(this.rendered_){return this.container.bbox()}else{throw"Only rendered fields have a container"}},toTop:function(){if(this.parent){this.parent.container.node.appendChild(this.container.node)}}});"use strict";BB.WorkspaceBasic={init:function(){this.borderColor=this.colorPalette.border[this.nested?"nested":"main"];if(this.nested){this.dragBoxColor=this.colorPalette.dragBoxColor;this.resizeBoxColor=this.colorPalette.resizeBoxColor;this.dragBox=this.workspace.root.rect(200,30).stroke({color:"#000",opacity:.4,width:2}).fill(this.borderColor).radius(1).move(-5,-25);this.titleRoot=this.workspace.root.text(this.title).font({size:20}).fill("#fff").move(0,-25);this.resizeButton=this.workspace.root.image(this.imageArrowBase64).opacity(1).size(20,20).move(170,-20);this.resizeBox=this.workspace.root.rect(10,10).stroke({color:this.borderColor,opacity:1,width:1}).fill(this.resizeBoxColor).radius(1).move(this.width-5,this.height-5).rotate(45);this.resizeArrows=this.workspace.root.image(this.imageArrowBase64).opacity(.5).size(50,50).move(this.width-25,this.height-25);this.borderShadow=this.workspace.root.rect(this.width,this.height).fill("none").radius(5);this.border=this.workspace.root.rect(this.width,this.height).stroke({color:this.borderColor,opacity:1,width:4}).fill("none").radius(5);this.hideResizeControls();this.container.add(this.borderShadow);this.container.add(this.border);this.container.add(this.dragBox);this.container.add(this.titleRoot);this.container.add(this.resizeButton);this.container.add(this.resizeBox);this.container.add(this.resizeArrows);this.borderShadow.addClass(this.style.className);var this_=this;PolymerGestures.addEventListener(this.resizeButton.node,"down",function(e){if(this_.resizeControls_){this_.hideResizeControls()}else{this_.showResizeControls()}e.preventDefault();e.stopPropagation()});this.container.draggable(this,null,[this.dragBox,this.titleRoot,this.border,this.borderShadow]);this.container.resizable(this,null,[this.resizeBox,this.resizeArrows]);var bbox=this.container.bbox();this.offsetX=this.x-bbox.x;this.offsetY=this.y-bbox.y;this.offsetX2=this.x+this.height+this.offsetX-bbox.x2;this.offsetY2=this.y+this.width+this.offsetY-bbox.y2}else{this.root.attr("style","border: 1px solid "+this.borderColor+";")}return this.nested?[this.dragBox,this.titleRoot,this.resizeButton,this.border,this.resizeBox,this.resizeArrows,this.borderShadow]:[]},showResizeControls:function(){this.resizeBox.show();this.resizeArrows.show();this.resizeControls_=true},hideResizeControls:function(){this.resizeBox.hide();this.resizeArrows.hide();this.resizeControls_=false},onBlur:function(){this.hideResizeControls()},onResize:function(width,height){this.border.size(width,height);this.borderShadow.size(width,height);if(this.resizeControls_){this.resizeBox.rotate(0).move(this.width-5,this.height-5).rotate(45);this.resizeArrows.move(this.width-5,this.height-25)}},onWidthChanged:function(width){this.border.width(width);this.borderShadow.width(width);if(this.resizeControls_){this.resizeBox.rotate(0).x(this.width-5).rotate(45);this.resizeArrows.x(this.width-25)}},onHeightChanged:function(height){this.border.height(height);this.borderShadow.height(height);if(this.resizeControls_){this.resizeBox.rotate(0).y(this.height-5).rotate(45);this.resizeArrows.y(this.height-25)}},imageArrowBase64:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/PjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDIzLjY1IDIzLjY1IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyMy42NSAyMy42NTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIHN0eWxlPSJmaWxsOiMwMzAxMDQ7IiBkPSJNMC41ODcsMC4wNTdsNi41MjksMC42MjFjMCwwLDAuODY5LTAuMDI3LDAuMzgzLDAuNDU3QzcuMDExLDEuNjI0LDUuODMzLDIuODAxLDUuODMzLDIuODAxUzYuMTIsMy4wOSw2LjU2MywzLjUyNmMxLjI1NCwxLjI1OCwzLjUzOSwzLjU0Myw0LjQ2OSw0LjQ3M2MwLDAsMC4zMTgsMC4xODktMC4wNjQsMC41N2MtMC4zODMsMC4zODctMi4wNzIsMi4wNjgtMi4zNDYsMi4zNDRjLTAuMjY4LDAuMjczLTAuNDc1LDAuMDU3LTAuNDc1LDAuMDU3Yy0wLjkwNC0wLjkwNC0zLjI3LTMuMjY2LTQuNDg0LTQuNDgyQzMuMjcxLDYuMDkyLDMuMDE1LDUuODM1LDMuMDE1LDUuODM1UzIuMDY3LDYuNzgsMS40NzQsNy4zNzRjLTAuNTksMC41OTItMC41ODgtMC4yOTktMC41ODgtMC4yOTlTMC4wNjIsMS4yMjUsMC4wNjIsMC41MkMwLjA2MiwwLjAxNiwwLjU4NywwLjA1NywwLjU4NywwLjA1N3oiLz48cGF0aCBzdHlsZT0iZmlsbDojMDMwMTA0OyIgZD0iTTIzLjEyMiwyMy42MDhsLTYuNTIzLTAuNjIxYzAsMC0wLjg3MSwwLjAyNS0wLjM4Ny0wLjQ2MWMwLjQ4Ni0wLjQ4NCwxLjY2Ni0xLjY2NiwxLjY2Ni0xLjY2NnMtMC4yODctMC4yODUtMC43MjctMC43MjNjLTEuMjU2LTEuMjYtMy41NDEtMy41NDMtNC40NzEtNC40NzljMCwwLTAuMzIyLTAuMTgsMC4wNjItMC41NjRzMi4wNy0yLjA3LDIuMzQ2LTIuMzQ0YzAuMjcxLTAuMjc1LDAuNDc3LTAuMDU5LDAuNDc3LTAuMDU5YzAuOTAyLDAuOTA2LDMuMjcsMy4yNyw0LjQ4Miw0LjQ4MmMwLjM5MywwLjM5NSwwLjY1LDAuNjU0LDAuNjUsMC42NTRzMC45NDktMC45NDcsMS41NDEtMS41NDFjMC41OS0wLjU5MiwwLjU5LDAuMzAxLDAuNTksMC4zMDFzMC44MjIsNS44NTQsMC44MjIsNi41NDlDMjMuNjUxLDIzLjY0NywyMy4xMjIsMjMuNjA4LDIzLjEyMiwyMy42MDh6Ii8+PHBhdGggc3R5bGU9ImZpbGw6IzAzMDEwNDsiIGQ9Ik0wLjAwMSwyMy4wOTRsMC42MTUtNi41MzFjMCwwLTAuMDIzLTAuODY5LDAuNDY1LTAuMzgzYzAuNDg0LDAuNDg2LDEuNjY0LDEuNjY4LDEuNjY0LDEuNjY4UzMuMDMsMTcuNTYxLDMuNDcsMTcuMTJjMS4yNTYtMS4yNTYsMy41NDEtMy41NDEsNC40NzUtNC40NzVjMCwwLDAuMTg0LTAuMzE2LDAuNTY4LDAuMDY2YzAuMzgzLDAuMzg3LDIuMDcsMi4wNzIsMi4zNDQsMi4zNDZjMC4yNzMsMC4yNzEsMC4wNTUsMC40NzcsMC4wNTUsMC40NzdjLTAuOTA2LDAuOTA0LTMuMjY2LDMuMjctNC40OCw0LjQ4NmMtMC4zOTUsMC4zOTMtMC42NTIsMC42NDgtMC42NTIsMC42NDhzMC45NDUsMC45NDcsMS41MzcsMS41MzdjMC41OTIsMC41OTQtMC4yOTcsMC41OS0wLjI5NywwLjU5cy01Ljg1LDAuODI0LTYuNTUxLDAuODI0Qy0wLjA0MiwyMy42MiwwLjAwMSwyMy4wOTQsMC4wMDEsMjMuMDk0eiIvPjxwYXRoIHN0eWxlPSJmaWxsOiMwMzAxMDQ7IiBkPSJNMjMuNTUyLDAuNTU3bC0wLjYxNSw2LjUyOWMwLDAsMC4wMjMsMC44NjktMC40NjEsMC4zODNjLTAuNDktMC40OS0xLjY2OC0xLjY2NC0xLjY2OC0xLjY2NHMtMC4yODYsMC4yODYtMC43MjUsMC43MjVjLTEuMjU2LDEuMjU2LTMuNTQzLDMuNTQxLTQuNDc1LDQuNDczYzAsMC0wLjE4NCwwLjMxOC0wLjU2OC0wLjA2NnMtMi4wNjgtMi4wNjYtMi4zNDYtMi4zNGMtMC4yNy0wLjI3OS0wLjA1Ny0wLjQ4Mi0wLjA1Ny0wLjQ4MmMwLjkwNi0wLjkwNCwzLjI3LTMuMjY4LDQuNDg0LTQuNDhjMC4zOTYtMC4zOTUsMC42NS0wLjY1MiwwLjY1LTAuNjUycy0wLjk0My0wLjk0NS0xLjUzNy0xLjUzOWMtMC41OTItMC41OTIsMC4yOTktMC41ODYsMC4yOTktMC41ODZzNS44NDktMC44MjgsNi41NTItMC44MjhDMjMuNTk1LDAuMDMsMjMuNTUyLDAuNTU3LDIzLjU1MiwwLjU1N3oiLz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PC9zdmc+"};"use strict";BB.FieldSvg=BB.Field.prototype.create({constructor:function(svg,parent,options){BB.Field.prototype.constructor.call(this,"Svg");this.children=[];this.container=null;this.childContainer=null;this.root=null;if(svg&&typeof svg=="object"){this.svg=svg}else{throw"Svg must be a valid SVG.js object";return}if(parent){this.parent=parent}if(!options){return}if(options.render){this.render()}},render:function(){if(!this.parent){throw"FieldSvg must have a parent to be rendered";return}if(!this.rendered_){this.container=this.parent.container.group();this.container.add(this.svg)}if(this.parent.attachDraggable){this.parent.attachDraggable.push(this.container)}this.rendered_=true}});"use strict";BB.FieldText=BB.Field.prototype.create({constructor:function(text,parent,options){BB.Field.prototype.constructor.call(this,"Text");this.children=[];this.container=null;this.childContainer=null;this.root=null;this.fontFamily="sans-serif";this.fontColor="#fff";this.size=15;if(text&&typeof text=="string"){this.text=text}else{throw"Text must be a valid string";return}if(parent){this.parent=parent}if(!options){return}if(options.fontColor){this.fontColor=options.fontColor}if(options.fontFamily){this.fontFamily=options.fontFamily}if(options.fontSize){this.fontSize=options.fontSize}if(options.render){this.render()}},render:function(){if(!this.parent){throw"FieldText must have a parent to be rendered";return}if(!this.rendered_){this.container=this.parent.container.text(this.text).font({family:this.fontFamily,size:this.fontSize}).fill(this.fontColor).style("text-rendering: geometricPrecision")}if(this.parent.attachDraggable){this.parent.attachDraggable.push(this.container)}this.rendered_=true}});"use strict";BB.FieldButton=BB.Field.prototype.create({constructor:function(text,parent,ondown,options){BB.Field.prototype.constructor.call(this,"Button");this.children=[];this.container=null;this.childContainer=null;this.root=null;this.width=0;this.height=0;this.style={className:"BBFieldButton",classPressedName:"BBFieldButtonPressed",text:{fontFamily:"sans-serif",fontColor:"#fff",size:15}};if(text&&typeof text=="string"){this.text=text}else{throw"Text must be a valid string";return}if(ondown){this.ondown=ondown}if(parent){this.parent=parent}if(!options){return}if(options.style){this.style=options.style}if(options.render){this.render()}},render:function(){if(!this.parent){throw"FieldButton must have a parent to be rendered";return}if(!this.rendered_){this.container=this.parent.container.group().addClass(this.style.className);this.textSvg=this.container.text(this.text).font({family:this.style.text.fontFamily,size:this.style.text.fontSize}).fill(this.style.text.fontColor).move(7,0).style("text-rendering: geometricPrecision");var textBBox=this.textSvg.bbox();this.width=textBBox.width+14;this.height=textBBox.height;this.root=(new SVG.Rect).size(this.width,this.height).radius(3);this.container.node.insertBefore(this.root.node,this.textSvg.node)}var this_=this;PolymerGestures.addEventListener(this.container.node,"down",function(event){this_.container.addClass(this_.style.classPressedName);if(this_.ondown){this_.ondown()}else{console.log("(Debug) FieldButton don't have a ondown handler! .\n Text: "+this_.text)}event.preventDefault()});PolymerGestures.addEventListener(this.container.node,"up",function(){this_.container.removeClass(this_.style.classPressedName)});this.rendered_=true}});"use strict";BB.FieldTextInput=BB.Field.prototype.create({constructor:function(text,parent,options){BB.Field.prototype.constructor.call(this,"TextInput");this.children=[];this.container=null;this.childContainer=null;this.root=null;this.textRoot=null;this.fontFamily="sans-serif";this.fontColor="#000";this.selectionColor="#3399FF";this.backgroundColor="#FFFFFF";this.size=15;this.width_=0;this.minWidth=10;this.height_=this.size+3;this.style={className:"BBFieldTextInput",editableTextBackground:"BBEditableTextBackground"};this.textMetrics_=null;this.textWidth_=0;this.lastTextWidth_=0;this.initialSpaceX_=1;this.initialSpaceY_=1;this.finalSpaceX_=1;this.finalSpaceY_=1;this.textRootOffset_=1;this.offsetX_=0;this.initialCursorY_=1;this.initialCursorX_=0;this.cursor=null;this.cursorXY={x:0,y:0};this.cursorState=0;this.cursorInterval=null;this.selectable=true;this.draggableIndex=-1;this.fluid=true;if(text&&typeof text=="string"){this.text=text;this.mirrorText=text}else{throw"Text must be a valid string";return}if(parent){this.parent=parent}if(!options){return}this.optionList=[["fontColor","public"],["fontFamily","public"],["fontSize","public"],["minWidth","public"],["height","private"],["fluid","public"]];for(var i=0,el;el=this.optionList[i];i++){if(options.hasOwnProperty(el[0])){var opt=el[1]=="public"?el[0]:el[0]+"_";this[opt]=options[el[0]]}}if(options.render){this.render()}},render:function(){if(!this.parent){throw"FieldTextInput must have a parent to be rendered";return}if(!this.rendered_){this.container=this.parent.container.group().addClass(this.style.className);this.mainBackground=this.container.rect(0,0);this.root=this.container.nested().attr("style","overflow: hidden;");this.mirrorRoot=this.root.text(this.text).font({family:this.fontFamily,size:this.fontSize}).fill(this.fontColor).move(this.textRootOffset_,0).style("text-rendering: geometricPrecision");var textLength=this.mirrorRoot.node.getComputedTextLength();this.textWidth_=textLength;this.setWidth(textLength);this.mainBackground.size(this.width_+this.initialSpaceX_+this.finalSpaceX_,this.height_+this.initialSpaceY_+this.finalSpaceY_).move(0,0).addClass(this.style.editableTextBackground).radius(4);this.root.size(this.width_,this.height_).move(this.initialSpaceX_,this.initialSpaceY_);this.background=this.root.rect(this.width_,this.height_).move(0,0);this.selectionRoot=this.root.rect(0,this.initialCursorY_+this.size).move(0,0).fill(this.selectionColor);this.textRoot=this.root.text(this.text.replace(/ /g,"")).font({family:this.fontFamily,size:this.fontSize}).fill(this.fontColor).move(this.textRootOffset_,0).style("text-rendering: geometricPrecision");this.getTextMetrics_();this.foreignTextInput=this.container.foreignObject(0,0).attr({id:"fobj"}).appendChild("input",{type:"text",value:this.text});if(this.fluid){this.setMaxChars(120)}else{this.setMaxChars(250)}var this_=this;var KeyboardHandler=function(e){var keyId,refreshCursor=false,textChanged=false;if(e.key){keyId=e.key}else if(e.keyIdentifier){keyId=e.keyIdentifier}if(keyId=="Enter"){return}if(e.which==8||e.which==46||keyId=="Left"||keyId=="Right"||keyId=="Up"||keyId=="Down"||keyId=="Home"||keyId=="End"||keyId=="ArrowLeft"||keyId=="ArrowRight"||keyId=="ArrowUp"||keyId=="ArrowDown"){if(e.which==8||e.which==46){if(this_.text!=e.target.value){this_.text=e.target.value;this_.textRoot.text(this_.text.replace(/ /g,""));this_.getTextMetrics_(-1,this_.foreignTextInput.getChild(0).selectionStart);textChanged=true}}}else{if(this_.text!=e.target.value){this_.text=e.target.value;this_.textRoot.text(this_.text.replace(/ /g,""));this_.getTextMetrics_(-1,this_.foreignTextInput.getChild(0).selectionStart);textChanged=true}}var selectionStart=this_.foreignTextInput.getChild(0).selectionStart,mirrorText,selectionEnd=this_.foreignTextInput.getChild(0).selectionEnd,selectionWidth=0,i,caretPos=selectionStart;for(i=selectionStart;i<selectionEnd;i++){selectionWidth+=this_.textMetrics_[i]}if(selectionWidth==0){this_.showCursor()}else{this_.hideCursor()}mirrorText=this_.text.substr(0,caretPos);this_.mirrorText=mirrorText;this_.mirrorRoot.text(mirrorText.replace(/ /g,""));var textLength=this_.mirrorRoot.node.getComputedTextLength();if(keyId=="Left"||keyId=="Right"||keyId=="Up"||keyId=="Down"||keyId=="Home"||keyId=="End"||keyId=="ArrowLeft"||keyId=="ArrowRight"||keyId=="ArrowUp"||keyId=="ArrowDown"){if(-this_.offsetX_>textLength){this_.offsetX_=-textLength}}else{if(!this_.fluid&&-this_.offsetX_+this_.width_>=this_.lastTextWidth_&&this_.width_<this_.lastTextWidth_){this_.offsetX_=this_.width-this_.textWidth_>0?0:this_.width_-this_.textWidth_}}if(!this_.fluid){if(this_.width_-this_.offsetX_<=textLength){this_.offsetX_=this_.width_-textLength}}this_.cursor.move(this_.initialCursorX_+this_.textRootOffset_+this_.offsetX_+textLength,this_.initialCursorY_);this_.textRoot.x(this_.initialCursorX_+this_.offsetX_+this_.textRootOffset_);this_.selectionRoot.move(this_.initialCursorX_+this_.textRootOffset_+this_.offsetX_+textLength,this_.initialCursorY_);this_.selectionRoot.width(selectionWidth);if(textChanged&&this_.fluid){this_.setWidth(this_.textWidth_)}};this.foreignTextInput.getChild(0).addEventListener("keyup",KeyboardHandler);this.foreignTextInput.getChild(0).addEventListener("keydown",KeyboardHandler);this.trackStarted=false;this.pointerCaretHandler=function(e){var mousePos=mouseToSvg(e,this_.root.node),i,len,pos1=0,pos2=0;mousePos.x-=this_.initialCursorX_+this_.offsetX_;for(i=0,len=this_.textMetrics_.length;i<=len;i++){pos1=pos2;pos2+=(i==0?0:this_.textMetrics_[i-1]/2)+(i==len?0:this_.textMetrics_[i]/2);if(pos1<=mousePos.x&&mousePos.x<pos2){break}}this_.selectionRoot.width(0);this_.mirrorText=this_.text.substr(0,i);this_.mirrorRoot.text(this_.mirrorText.replace(/ /g,""));setCaretPosition(this_.foreignTextInput.getChild(0),i)};PolymerGestures.addEventListener(this.root.node,"up",function(e){if(this_.trackStarted==false&&this_.selected_==false){this_.pointerCaretHandler(e);this_.showCursor();this_.setSelected(true)}else{this_.trackStarted=false}});PolymerGestures.addEventListener(this.root.node,"down",function(e){if(this_.trackStarted==false&&this_.selected_==true){this_.pointerCaretHandler(e);this_.showCursor();this_.setSelected(true);this_.referenceCursorSelection=this_.foreignTextInput.getChild(0).selectionStart;this_.referenceOffsetX_=this_.offsetX_}else{this_.trackStarted=false}});PolymerGestures.addEventListener(this.root.node,"trackstart",function(e){this_.trackStarted=true});this.pointerCaretSelectionHandler=function(e){var mousePos=mouseToSvg(e,this_.root.node),i,len,pos1=0,pos2=0;mousePos.x-=this_.initialCursorX_+this_.offsetX_;if(mousePos.x<0){i=0;
}else{for(i=0,len=this_.textMetrics_.length;i<=len;i++){pos1=pos2;pos2+=(i==0?0:this_.textMetrics_[i-1]/2)+(i==len?0:this_.textMetrics_[i]/2);if(pos1<=mousePos.x&&mousePos.x<pos2){break}}}var reverseSelection=false;var doffsetX_=this_.offsetX_-this_.referenceOffsetX_;if(e.dx>=doffsetX_){this_.foreignTextInput.getChild(0).selectionStart=this_.referenceCursorSelection;this_.foreignTextInput.getChild(0).selectionEnd=i}else{this_.foreignTextInput.getChild(0).selectionStart=i;this_.foreignTextInput.getChild(0).selectionEnd=this_.referenceCursorSelection;reverseSelection=true}var selectionStart=this_.foreignTextInput.getChild(0).selectionStart,mirrorText,selectionEnd=this_.foreignTextInput.getChild(0).selectionEnd,selectionWidth=0;for(i=selectionStart;i<selectionEnd;i++){selectionWidth+=this_.textMetrics_[i]}if(selectionWidth==0){this_.showCursor()}else{this_.hideCursor()}var textLength=this_.mirrorRoot.node.getComputedTextLength();if(!this_.fluid)var selectionDx=(reverseSelection?-1:1)*selectionWidth;if(-this_.offsetX_>textLength+selectionDx){this_.offsetX_=-textLength-selectionDx}if(this_.width_-this_.offsetX_<=textLength+selectionDx){this_.offsetX_=this_.width_-textLength-selectionDx}this_.textRoot.x(this_.initialCursorX_+this_.offsetX_+this_.textRootOffset_);this_.selectionRoot.move(this_.initialCursorX_+this_.textRootOffset_+this_.offsetX_+textLength-(reverseSelection?selectionWidth:0),this_.initialCursorY_);this_.selectionRoot.width(selectionWidth);this_.setSelected(true)};this.rendered_=true;var tempSelected=this.selected_;this.selected_=!this.selected_;this.setSelected(tempSelected)}},showCursor:function(pos){if(pos){this.cursorXY=pos}else{var textLength=this.mirrorRoot.node.getComputedTextLength();this.cursorXY.x=this.initialCursorX_+this.textRootOffset_+this.offsetX_+textLength;this.cursorXY.y=this.initialCursorY_}var x=this.cursorXY.x,y=this.cursorXY.y;if(!this.cursor){this.cursor=this.root.line(x,y,x,y+this.size+1).stroke({width:1})}else{this.cursor.move(x,y)}this.hideCursor();if(!this.cursorInterval){this.cursor.stroke({opacity:1});this.cursorState=1;var this_=this;this.cursorInterval=setInterval(function(){if(this_.cursorState==0){this_.cursor.stroke({opacity:1});this_.cursorState=1}else{this_.cursor.stroke({opacity:0});this_.cursorState=0}},530)}},hideCursor:function(){if(this.cursor){this.cursor.stroke({opacity:0});clearInterval(this.cursorInterval);this.cursorInterval=null}},getTextMetrics_:function(keydiff,position){var tempMirrorText=this.text,lastWidth=0;this.lastTextWidth_=this.textWidth_;var textMetrics_,textLength,textLength2,textLength3,dx1,dx2;if(keydiff==undefined||this.textMetrics_==null){textMetrics_=[];for(var i=1,len=this.text.length;i<=len;i++){tempMirrorText=this.text.substr(0,i);this.mirrorRoot.text(tempMirrorText.replace(/ /g,""));textLength=this.mirrorRoot.node.getComputedTextLength();textMetrics_.push(textLength-lastWidth);lastWidth=textLength}}else{if(position==undefined){throw"If keydiff are defined position is not optional"}if(keydiff==-1&&this.text!=this.lastText){textMetrics_=this.textMetrics_;tempMirrorText=this.text.substr(0,position-1);this.mirrorRoot.text(tempMirrorText.replace(/ /g,""));textLength=this.mirrorRoot.node.getComputedTextLength();tempMirrorText=this.text.substr(0,position);this.mirrorRoot.text(tempMirrorText.replace(/ /g,""));textLength2=this.mirrorRoot.node.getComputedTextLength();dx1=textLength2-textLength;tempMirrorText=this.text.substr(0,position+1);this.mirrorRoot.text(tempMirrorText.replace(/ /g,""));textLength3=this.mirrorRoot.node.getComputedTextLength();dx2=textLength3-textLength2;textMetrics_=textMetrics_.slice(0,position-1).concat([dx1].concat(textMetrics_.slice(position)));if(dx2!=0){textMetrics_=textMetrics_.slice(0,position).concat([dx2].concat(textMetrics_.slice(position)))}}}this.textWidth_=this.textRoot.node.getComputedTextLength();this.lastText=this.text;this.mirrorRoot.text(this.text.replace(/ /g,""));if(textMetrics_!=undefined){this.textMetrics_=textMetrics_}},onSelect:function(){this.foreignTextInput.getChild(0).focus();this.background.fill(this.backgroundColor);this.mainBackground.fill(this.backgroundColor);this.mainBackground.removeClass(this.style.editableTextBackground);this.background.opacity(1);this.mirrorRoot.opacity(1);this.container.removeClass("BBFieldTextInput");this.showCursor();PolymerGestures.addEventListener(this.root.node,"track",this.pointerCaretSelectionHandler);if(this.parent.attachDraggable){if(this.parent.container.fixedDrag){this.parent.container.fixedDrag()}this.parent.attachDraggable=this.parent.attachDraggable.slice(0,this.draggableIndex).concat(this.parent.attachDraggable.slice(this.draggableIndex+1));this.draggableIndex=-1}},onBlur:function(){this.foreignTextInput.getChild(0).blur();this.selectionRoot.width(0);this.hideCursor();this.mainBackground.addClass(this.style.editableTextBackground);this.background.opacity(0);this.mirrorRoot.opacity(0);this.container.addClass("BBFieldTextInput");PolymerGestures.removeEventListener(this.root.node,"track",this.pointerCaretSelectionHandler);if(this.parent.attachDraggable){this.parent.attachDraggable.push(this.container);this.draggableIndex=this.parent.attachDraggable.length-1}},onSelectedChange:function(){if(this.parent.attachDraggable){this.parent.updateDraggable()}},onUnRender:function(){this.hideCursor();this.cursor=null},setMaxChars:function(num){if(num!=undefined){this.maxChars_=num;this.foreignTextInput.getChild(0).maxLength=num}else{throw"Num is not optional"}},setWidth:function(width){if(width!=undefined&&typeof width=="number"){if(width!=this.width_){this.width_=Math.max(width+2,this.minWidth);if(this.rendered_){this.mainBackground.width(this.width_+this.initialSpaceX_+this.finalSpaceX_);this.background.width(this.width_);this.root.width(this.width_);this.parent.fieldChanged(this.index)}}}else{throw"Not valid width"}},bbox:function(type){if(this.rendered_){var bbox=this.root.viewbox();bbox.width_+=this.initialSpaceX_+this.finalSpaceX_;bbox.height_+=this.initialSpaceY_+this.finalSpaceY_;return bbox}else{throw"Only rendered fields have a container"}}});